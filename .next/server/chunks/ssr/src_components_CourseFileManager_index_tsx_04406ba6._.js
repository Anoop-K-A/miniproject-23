module.exports=[10801,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(91119),e=a.i(99570),f=a.i(66718),g=a.i(70430),h=a.i(80701),i=a.i(6015),j=a.i(14574),k=a.i(73320),l=a.i(4720),m=a.i(84505),n=a.i(81560),o=a.i(87532),p=a.i(69012),q=a.i(63588),r=a.i(77156),s=a.i(23808),t=a.i(60246),u=a.i(86304),v=a.i(23292),w=a.i(24348),x=a.i(33483),y=a.i(75083),z=a.i(47219),A=a.i(210);function B({file:a,onBack:c,onDownload:d}){return(0,b.jsx)("div",{className:"bg-white border-b sticky top-0 z-10",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)(e.Button,{variant:"outline",onClick:c,children:[(0,b.jsx)(A.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to Files"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-semibold",children:a.fileName}),(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:[a.courseCode," - ",a.courseName]})]})]}),(0,b.jsxs)(e.Button,{onClick:()=>d(a),children:[(0,b.jsx)(m.Download,{className:"h-4 w-4 mr-2"}),"Download"]})]})})})}function C({file:a}){return(0,b.jsxs)(d.Card,{className:"border-0 shadow-sm",children:[(0,b.jsx)("div",{className:"aspect-video bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg flex items-center justify-center border-2 border-dashed border-gray-300",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(l.FileText,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Document Preview"}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["File: ",a.fileName]})]})}),(0,b.jsxs)("div",{className:"p-4 space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"File Type:"}),(0,b.jsx)("span",{className:"text-sm text-gray-900",children:".pdf"})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Upload Date:"}),(0,b.jsx)("span",{className:"text-sm text-gray-900",children:a.uploadDate})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),(0,b.jsx)(u.Badge,{variant:"Approved"===a.status?"default":"Pending"===a.status?"secondary":"outline",children:a.status})]})]})]})}var D=a.i(46842),E=a.i(53722),F=a.i(41675);function G({file:a}){return(0,b.jsxs)(d.Card,{className:"p-4 space-y-4",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:"File Information"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(D.User,{className:"h-4 w-4 text-gray-400 mt-1 flex-shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Faculty"}),(0,b.jsx)("p",{className:"text-sm text-gray-900",children:a.facultyName})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(E.BookOpen,{className:"h-4 w-4 text-gray-400 mt-1 flex-shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Department"}),(0,b.jsx)("p",{className:"text-sm text-gray-900",children:a.department})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(E.BookOpen,{className:"h-4 w-4 text-gray-400 mt-1 flex-shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Course"}),(0,b.jsx)("p",{className:"text-sm text-gray-900",children:a.courseName}),(0,b.jsx)("p",{className:"text-xs text-gray-600",children:a.courseCode})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(F.Calendar,{className:"h-4 w-4 text-gray-400 mt-1 flex-shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Semester"}),(0,b.jsx)("p",{className:"text-sm text-gray-900",children:a.semester})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(F.Calendar,{className:"h-4 w-4 text-gray-400 mt-1 flex-shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Upload Date"}),(0,b.jsx)("p",{className:"text-sm text-gray-900",children:a.uploadDate})]})]}),a.status&&(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"h-4 w-4 mt-1 flex-shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Status"}),(0,b.jsx)(u.Badge,{variant:"Approved"===a.status?"default":"Pending"===a.status?"secondary":"outline",children:a.status})]})]})]})]})}let H=(0,a.i(70106).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var I=a.i(92e3);function J({file:a}){return a.adminRemarks?(0,b.jsx)(w.Alert,{className:"Approved"===a.status?"border-green-200 bg-green-50":"border-yellow-200 bg-yellow-50",children:(0,b.jsxs)("div",{className:"flex gap-3",children:["Approved"===a.status?(0,b.jsx)(H,{className:"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0"}):(0,b.jsx)(I.AlertCircle,{className:"h-4 w-4 text-yellow-600 mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)("h4",{className:"font-semibold text-gray-900",children:"Admin Review"}),(0,b.jsx)(u.Badge,{variant:"Approved"===a.status?"default":"secondary",children:a.status})]}),(0,b.jsx)(w.AlertDescription,{className:"text-gray-700 text-sm",children:a.adminRemarks}),a.reviewedBy&&a.reviewedDate&&(0,b.jsxs)("p",{className:"text-xs text-gray-600 mt-2",children:["Reviewed by ",a.reviewedBy," on ",a.reviewedDate]})]})]})}):null}var K=a.i(50104),L=a.i(46872),M=a.i(72752),N=a.i(30553),O="Avatar",[P,Q]=(0,K.createContextScope)(O),[R,S]=P(O),T=c.forwardRef((a,d)=>{let{__scopeAvatar:e,...f}=a,[g,h]=c.useState("idle");return(0,b.jsx)(R,{scope:e,imageLoadingStatus:g,onImageLoadingStatusChange:h,children:(0,b.jsx)(N.Primitive.span,{...f,ref:d})})});T.displayName=O;var U="AvatarImage",V=c.forwardRef((a,d)=>{let{__scopeAvatar:e,src:f,onLoadingStatusChange:g=()=>{},...h}=a,i=S(U,e),j=function(a,b){let[d,e]=c.useState("idle");return(0,M.useLayoutEffect)(()=>{if(!a)return void e("error");let c=!0,d=new window.Image,f=a=>()=>{c&&e(a)};return e("loading"),d.onload=f("loaded"),d.onerror=f("error"),d.src=a,b&&(d.referrerPolicy=b),()=>{c=!1}},[a,b]),d}(f,h.referrerPolicy),k=(0,L.useCallbackRef)(a=>{g(a),i.onImageLoadingStatusChange(a)});return(0,M.useLayoutEffect)(()=>{"idle"!==j&&k(j)},[j,k]),"loaded"===j?(0,b.jsx)(N.Primitive.img,{...h,ref:d,src:f}):null});V.displayName=U;var W="AvatarFallback",X=c.forwardRef((a,d)=>{let{__scopeAvatar:e,delayMs:f,...g}=a,h=S(W,e),[i,j]=c.useState(void 0===f);return c.useEffect(()=>{if(void 0!==f){let a=window.setTimeout(()=>j(!0),f);return()=>window.clearTimeout(a)}},[f]),i&&"loaded"!==h.imageLoadingStatus?(0,b.jsx)(N.Primitive.span,{...g,ref:d}):null});X.displayName=W;var Y=a.i(10251);function Z({className:a,...c}){return(0,b.jsx)(T,{"data-slot":"avatar",className:(0,Y.cn)("relative flex size-10 shrink-0 overflow-hidden rounded-full",a),...c})}function $({className:a,...c}){return(0,b.jsx)(V,{"data-slot":"avatar-image",className:(0,Y.cn)("aspect-square size-full",a),...c})}function _({className:a,...c}){return(0,b.jsx)(X,{"data-slot":"avatar-fallback",className:(0,Y.cn)("bg-muted flex size-full items-center justify-center rounded-full",a),...c})}var aa=a.i(76841),ab=a.i(15618);function ac({reviews:a,selectedReview:c,onSelectReview:f,onAddReview:g}){return(0,b.jsxs)(d.Card,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:"Peer Reviews"}),(0,b.jsxs)(e.Button,{size:"sm",variant:"outline",onClick:g,className:"gap-2",children:[(0,b.jsx)(ab.Plus,{className:"h-4 w-4"}),"Add Review"]})]}),0===a.length?(0,b.jsx)("p",{className:"text-sm text-gray-600 text-center py-4",children:"No peer reviews yet. Be the first to review!"}):(0,b.jsx)(aa.Accordion,{type:"single",collapsible:!0,className:"w-full",children:a.map(a=>(0,b.jsxs)(aa.AccordionItem,{value:a.id,className:"border-b",children:[(0,b.jsx)(aa.AccordionTrigger,{className:"hover:no-underline py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-3 w-full",children:[(0,b.jsxs)(Z,{className:"h-8 w-8",children:[(0,b.jsx)($,{src:a.reviewerAvatar}),(0,b.jsx)(_,{children:a.reviewerName.split(" ").map(a=>a[0]).join("")})]}),(0,b.jsxs)("div",{className:"text-left flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-sm text-gray-900",children:a.reviewerName}),(0,b.jsx)("p",{className:"text-xs text-gray-600",children:a.reviewDate})]}),(0,b.jsx)(q.MessageSquare,{className:"h-4 w-4 text-gray-400"})]})}),(0,b.jsxs)(aa.AccordionContent,{className:"pt-4 space-y-3",children:[(0,b.jsx)("p",{className:"text-sm text-gray-700",children:a.comment}),a.facultyResponse&&(0,b.jsxs)("div",{className:"bg-blue-50 border-l-4 border-blue-200 p-3 rounded",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-blue-900 mb-1",children:"Faculty Response"}),(0,b.jsx)("p",{className:"text-sm text-blue-700",children:a.facultyResponse})]})]})]},a.id))})]})}var ad=a.i(21562);function ae({file:a,onBack:d}){let[e,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(a.peerReviews||[]);return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)(B,{file:a,onBack:d,onDownload:a=>{let b=(0,ad.sanitizeFileName)(a.fileName,"course-file");if(a.documentUrl)return void(0,ad.downloadFromDataUrl)(a.documentUrl,b);let c=b.replace(/\.[^/.]+$/,""),d=`${c||"course-file"}-summary.txt`,e=`File Name: ${a.fileName}
Course: ${a.courseCode} - ${a.courseName}
Type: ${a.fileType}
Semester: ${a.semester}
Academic Year: ${a.academicYear}
Uploaded: ${a.uploadDate}
Faculty: ${a.facultyName}
Department: ${a.department}
Status: ${a.status??"Unknown"}`;(0,ad.downloadTextFile)(e,d)}}),(0,b.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"col-span-2 space-y-6",children:[(0,b.jsx)(C,{file:a}),(0,b.jsx)(J,{file:a}),(0,b.jsx)(ac,{reviews:k,selectedReview:i,onSelectReview:j,onAddReview:()=>f(!0)})]}),(0,b.jsx)("div",{children:(0,b.jsx)(G,{file:a})})]})}),e&&(0,b.jsx)(z.PeerReviewDialog,{open:e,onOpenChange:f,onSubmit:a=>{l([...k,{id:Date.now().toString(),reviewerName:"Current User",comment:a,reviewDate:new Date().toLocaleDateString(),facultyResponse:void 0,reviewerAvatar:`https://api.dicebear.com/7.x/avataaars/svg?seed=${Math.random()}`}]),f(!1)},itemType:"file",itemName:a.fileName}),i&&g&&(0,b.jsx)(x.ResponseDialog,{open:g,onOpenChange:h,onSubmit:a=>{i&&(l(k.map(b=>b.id===i.id?{...b,facultyResponse:a}:b)),j(null),h(!1))},itemType:"file"})]})}function af({files:a,currentUser:g,onFilesChange:j}){let[k,n]=(0,c.useState)(""),[s,t]=(0,c.useState)("all"),[w,y]=(0,c.useState)("all"),[A,B]=(0,c.useState)("all"),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(null),M=a=>{let b=(0,ad.sanitizeFileName)(a.fileName,"course-file");if(a.documentUrl){(0,ad.downloadFromDataUrl)(a.documentUrl,b),v.toast.success(`Downloading ${a.fileName}`);return}let c=b.replace(/\.[^/.]+$/,""),d=`${c||"course-file"}-summary.txt`,e=`File Name: ${a.fileName}
Course: ${a.courseCode} - ${a.courseName}
Type: ${a.fileType}
Semester: ${a.semester}
Academic Year: ${a.academicYear}
Uploaded: ${a.uploadDate}
Faculty: ${a.facultyName}
Department: ${a.department}
Status: ${a.status??"Unknown"}`;(0,ad.downloadTextFile)(e,d),v.toast.success(`Downloaded summary for ${a.fileName}`)},N=async a=>{if(!E)return;let b={id:`pr${Date.now()}`,reviewerName:g,reviewDate:new Date().toISOString().split("T")[0],comment:a},c={...E,peerReviews:[...E.peerReviews||[],b]};try{let a=await fetch(`/api/course-files/${E.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({peerReviews:c.peerReviews})}),b=await a.json();if(!a.ok)return void v.toast.error(b.error||"Peer review failed");j?.(b.files);let d=b.files.filter(a=>a.id===E.id).reduce((a,b)=>a??b,void 0);F(d??c),H(!1)}catch(a){console.error("Peer review error:",a),v.toast.error("An error occurred while submitting review")}},O=async a=>{if(!E||!K)return;let b={...E,peerReviews:E.peerReviews?.map(b=>b.id===K.id?{...b,facultyResponse:a,responseDate:new Date().toISOString().split("T")[0]}:b)};try{let a=await fetch(`/api/course-files/${E.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({peerReviews:b.peerReviews})}),c=await a.json();if(!a.ok)return void v.toast.error(c.error||"Response failed");j?.(c.files);let d=c.files.filter(a=>a.id===E.id).reduce((a,b)=>a??b,void 0);F(d??b),L(null),J(!1)}catch(a){console.error("Response error:",a),v.toast.error("An error occurred while responding")}},P=a.filter(a=>{let b=a.fileName.toLowerCase().includes(k.toLowerCase())||a.courseCode.toLowerCase().includes(k.toLowerCase())||a.facultyName.toLowerCase().includes(k.toLowerCase()),c="all"===s||a.department===s,d="all"===w||a.status===w,e="all"===A||a.academicYear===A;return b&&c&&d&&e}),Q=Array.from(new Set(a.map(a=>a.department))),R=Array.from(new Set(a.map(a=>a.academicYear)));return C&&E?(0,b.jsx)(ae,{file:E,onBack:()=>D(!1),onDownload:M,onPeerReview:N,onRespondToReview:O,currentUser:g}):(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"pt-6 space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(o.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,b.jsx)(f.Input,{placeholder:"Search by file name, course, or faculty...",value:k,onChange:a=>n(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(h.Select,{value:s,onValueChange:t,children:[(0,b.jsxs)(h.SelectTrigger,{className:"w-full md:w-48",children:[(0,b.jsx)(p.Filter,{className:"h-4 w-4 mr-2"}),(0,b.jsx)(h.SelectValue,{placeholder:"Department"})]}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Departments"}),Q.map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:a},a))]})]}),(0,b.jsxs)(h.Select,{value:w,onValueChange:y,children:[(0,b.jsxs)(h.SelectTrigger,{className:"w-full md:w-48",children:[(0,b.jsx)(p.Filter,{className:"h-4 w-4 mr-2"}),(0,b.jsx)(h.SelectValue,{placeholder:"Status"})]}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Status"}),(0,b.jsx)(h.SelectItem,{value:"Approved",children:"Approved"}),(0,b.jsx)(h.SelectItem,{value:"Pending",children:"Pending"}),(0,b.jsx)(h.SelectItem,{value:"Rejected",children:"Rejected"})]})]}),(0,b.jsxs)(h.Select,{value:A,onValueChange:B,children:[(0,b.jsxs)(h.SelectTrigger,{className:"w-full md:w-48",children:[(0,b.jsx)(p.Filter,{className:"h-4 w-4 mr-2"}),(0,b.jsx)(h.SelectValue,{placeholder:"Academic Year"})]}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Years"}),R.map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:a},a))]})]})]}),(0,b.jsx)("div",{className:"border rounded-lg",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"File Name"}),(0,b.jsx)(i.TableHead,{children:"Faculty"}),(0,b.jsx)(i.TableHead,{children:"Course"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{children:"Peer Reviews"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(i.TableBody,{children:0===P.length?(0,b.jsx)(i.TableRow,{children:(0,b.jsx)(i.TableCell,{colSpan:6,className:"text-center text-gray-500 py-8",children:"No files found matching your criteria."})}):P.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsxs)(i.TableCell,{className:"flex items-center gap-2",children:[(0,b.jsx)(l.FileText,{className:"h-4 w-4 text-blue-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{children:a.fileName}),(0,b.jsx)("div",{className:"text-sm text-gray-500",children:a.fileType})]})]}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{children:a.facultyName}),(0,b.jsx)("div",{className:"text-sm text-gray-500",children:a.department})]})}),(0,b.jsxs)(i.TableCell,{children:[(0,b.jsx)("div",{children:a.courseCode}),(0,b.jsx)("div",{className:"text-sm text-gray-500",children:a.courseName})]}),(0,b.jsx)(i.TableCell,{children:a.status&&(0,b.jsx)(u.Badge,{className:"Approved"===a.status?"bg-green-100 text-green-800":"Rejected"===a.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800",children:a.status})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(q.MessageSquare,{className:"h-4 w-4 text-gray-400"}),(0,b.jsx)("span",{className:"text-sm",children:a.peerReviews?.length||0})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>M(a),children:(0,b.jsx)(m.Download,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>{F(a),D(!0)},children:(0,b.jsx)(r.Eye,{className:"h-4 w-4 text-blue-600"})})]})})]},a.id))})]})}),(0,b.jsx)(z.PeerReviewDialog,{open:G,onOpenChange:H,onSubmit:N,itemType:"file",itemName:E?.fileName||""}),(0,b.jsx)(x.ResponseDialog,{open:I,onOpenChange:a=>{J(a),a||L(null)},onSubmit:O,itemType:"file"})]})})}var ag=a.i(56025);function ah({initialFiles:a=[],fileCategories:z=[],fileTypes:A=[]}){var B;let C,[D,E]=(0,c.useState)(a),[F,G]=(0,c.useState)(z),[H,I]=(0,c.useState)(A),{user:J,userRole:K}=(0,ag.useAuth)(),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)("all"),[P,Q]=(0,c.useState)("all"),[R,S]=(0,c.useState)("all"),[T,U]=(0,c.useState)(!1),[V,W]=(0,c.useState)(""),[X,Y]=(0,c.useState)(""),[Z,$]=(0,c.useState)(""),[_,aa]=(0,c.useState)(""),[ab,ac]=(0,c.useState)(""),[ae,ah]=(0,c.useState)(""),[ai,aj]=(0,c.useState)(null),[ak,al]=(0,c.useState)(new Date().getFullYear().toString()),[am,an]=(0,c.useState)("my-files"),[ao,ap]=(0,c.useState)(null),[aq,ar]=(0,c.useState)(!1),[as,at]=(0,c.useState)(!1),[au,av]=(0,c.useState)(!1),[aw,ax]=(0,c.useState)([]);(0,c.useEffect)(()=>{let a=async()=>{if("faculty"!==K||!J?.id)return void ax([]);try{let a=await fetch(`/api/messages?facultyId=${J.id}`),b=await a.json();if(!a.ok)return void ax([]);let c=(b.messages??[]).filter(a=>"course-file"===a.entityType);ax(c)}catch(a){console.error("Load messages error:",a),ax([])}};(async()=>{try{let a=await fetch("/api/course-files"),b=await a.json();if(!a.ok)return void v.toast.error(b.error||"Failed to load files");E(b.files??[]),G(b.fileCategories??[]),I(b.fileTypes??[])}catch(a){console.error("Load files error:",a),v.toast.error("Failed to load files")}})(),a()},[J?.id,K]);let ay=async a=>{if(a.preventDefault(),!ae||!Z||!_||!V)return void v.toast.error("Please fill in all required fields");if(!ai)return void v.toast.error("Please choose a file to upload");try{let a=await fetch("/api/course-files",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({facultyId:J?.id,facultyName:J?.name??"",department:J?.department??"",fileName:ae,documentUrl:ai,courseCode:Z,courseName:_,fileType:V,uploadDate:new Date().toISOString().split("T")[0],semester:ab,academicYear:ak,size:"1.5 MB",status:"Pending"})}),b=await a.json();if(!a.ok)return void v.toast.error(b.error||"Upload failed");E(b.files),U(!1),v.toast.success("File uploaded successfully"),W(""),$(""),aa(""),ac(""),ah(""),aj(null),al(new Date().getFullYear().toString())}catch(a){console.error("File upload error:",a),v.toast.error("An error occurred during upload")}},az=async a=>{try{let b=await fetch(`/api/course-files/${a}`,{method:"DELETE"}),c=await b.json();if(!b.ok)return void v.toast.error(c.error||"Delete failed");E(c.files),v.toast.success("File deleted successfully")}catch(a){console.error("Delete error:",a),v.toast.error("An error occurred while deleting")}},aA=a=>{let b=(0,ad.sanitizeFileName)(a.fileName,"course-file");if(a.documentUrl){(0,ad.downloadFromDataUrl)(a.documentUrl,b),v.toast.success(`Downloading ${a.fileName}`);return}let c=b.replace(/\.[^/.]+$/,""),d=`${c||"course-file"}-summary.txt`,e=`File Name: ${a.fileName}
Course: ${a.courseCode} - ${a.courseName}
Type: ${a.fileType}
Semester: ${a.semester}
Academic Year: ${a.academicYear}
Uploaded: ${a.uploadDate}
Faculty: ${a.facultyName}
Department: ${a.department}
Status: ${a.status??"Unknown"}`;(0,ad.downloadTextFile)(e,d),v.toast.success(`Downloaded summary for ${a.fileName}`)},aB=async a=>{if(ao)try{let b=await fetch(`/api/course-files/${ao.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({facultyResponse:a})}),c=await b.json();if(!b.ok)return void v.toast.error(c.error||"Response update failed");E(c.files);let d=c.files.filter(a=>a.id===ao.id).reduce((a,b)=>a??b,void 0);d&&ap(d)}catch(a){console.error("Response error:",a),v.toast.error("An error occurred while saving response")}},aC=async a=>{if(!ao||!J?.id)return;let b=`course-file:${ao.id}`,c=aH[b]??[],d=c.find(a=>a.auditorId)?.auditorId;await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({facultyId:J.id,auditorId:d,entityType:"course-file",entityId:ao.id,threadId:b,senderRole:"faculty",senderName:J.name,message:a})})},aD=(0,c.useMemo)(()=>"faculty"===K&&J?.id?D.filter(a=>a.facultyId===J.id):D,[D,J?.id,K]),aE=aD.filter(a=>{let b=a.fileName.toLowerCase().includes(L.toLowerCase())||a.courseCode.toLowerCase().includes(L.toLowerCase())||a.courseName.toLowerCase().includes(L.toLowerCase()),c="all"===N||a.fileType===N,d="all"===P||a.status===P,e="all"===R||a.academicYear===R;return b&&c&&d&&e}),aF=Array.from(new Set(aD.map(a=>a.status).filter(Boolean))),aG=Array.from(new Set(aD.map(a=>a.academicYear))),aH=(0,c.useMemo)(()=>aw.reduce((a,b)=>{let c=b.threadId??`${b.entityType}:${b.entityId}`;return a[c]||(a[c]=[]),a[c].push({...b,threadId:c}),a},{}),[aw]);return(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Course File Management"}),(0,b.jsx)(d.CardDescription,{children:"Upload and manage course materials, syllabi, lesson plans, and assignments"})]}),(0,b.jsx)(d.CardContent,{className:"space-y-4",children:(0,b.jsxs)(y.Tabs,{defaultValue:"my-files",className:"w-full",children:[(0,b.jsxs)(y.TabsList,{className:"grid w-full grid-cols-2",children:[(0,b.jsx)(y.TabsTrigger,{value:"my-files",children:"My Files"}),(0,b.jsxs)(y.TabsTrigger,{value:"all-files",children:[(0,b.jsx)(t.Users,{className:"h-4 w-4 mr-2"}),"All Faculty Files"]})]}),(0,b.jsxs)(y.TabsContent,{value:"my-files",className:"space-y-4 mt-4",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(o.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,b.jsx)(f.Input,{placeholder:"Search files...",value:L,onChange:a=>M(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(h.Select,{value:N,onValueChange:O,children:[(0,b.jsxs)(h.SelectTrigger,{className:"w-full md:w-48",children:[(0,b.jsx)(p.Filter,{className:"h-4 w-4 mr-2"}),(0,b.jsx)(h.SelectValue,{placeholder:"Filter by Type"})]}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Types"}),H.map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:a},a))]})]}),(0,b.jsxs)(h.Select,{value:P,onValueChange:Q,children:[(0,b.jsxs)(h.SelectTrigger,{className:"w-full md:w-48",children:[(0,b.jsx)(p.Filter,{className:"h-4 w-4 mr-2"}),(0,b.jsx)(h.SelectValue,{placeholder:"Filter by Status"})]}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Statuses"}),aF.map(a=>(0,b.jsx)(h.SelectItem,{value:a||"unknown",children:a||"Unknown"},a||"unknown"))]})]}),(0,b.jsxs)(h.Select,{value:R,onValueChange:S,children:[(0,b.jsxs)(h.SelectTrigger,{className:"w-full md:w-48",children:[(0,b.jsx)(p.Filter,{className:"h-4 w-4 mr-2"}),(0,b.jsx)(h.SelectValue,{placeholder:"Filter by Year"})]}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Years"}),aG.map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:a},a))]})]}),(0,b.jsxs)(j.Dialog,{open:T,onOpenChange:U,children:[(0,b.jsx)(j.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(e.Button,{className:"w-full md:w-auto",children:[(0,b.jsx)(k.Upload,{className:"h-4 w-4 mr-2"}),"Upload File"]})}),(0,b.jsxs)(j.DialogContent,{className:"max-w-md",children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsx)(j.DialogTitle,{children:"Upload Course File"}),(0,b.jsx)(j.DialogDescription,{children:"Add a new course file to your repository"})]}),(0,b.jsxs)("form",{onSubmit:ay,className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{htmlFor:"file",children:"File"}),(0,b.jsx)(f.Input,{id:"file",type:"file",required:!0,accept:".pdf,.doc,.docx,.ppt,.pptx",onChange:a=>{let b=a.target.files?.[0];if(!b){ah(""),aj(null);return}ah(b.name);let c=new FileReader;c.onloadend=()=>{aj("string"==typeof c.result?c.result:null)},c.readAsDataURL(b)}})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{htmlFor:"category",children:"File Category *"}),(0,b.jsxs)(h.Select,{value:X,onValueChange:a=>Y(a),required:!0,children:[(0,b.jsx)(h.SelectTrigger,{id:"category",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select file category"})}),(0,b.jsx)(h.SelectContent,{children:F.map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{htmlFor:"courseCode",children:"Course Code"}),(0,b.jsx)(f.Input,{id:"courseCode",value:Z,onChange:a=>$(a.target.value),placeholder:"e.g., CS101",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{htmlFor:"courseName",children:"Course Name"}),(0,b.jsx)(f.Input,{id:"courseName",value:_,onChange:a=>aa(a.target.value),placeholder:"e.g., Introduction to Computer Science",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{htmlFor:"fileType",children:"File Type"}),(0,b.jsxs)(h.Select,{value:V,onValueChange:a=>W(a),children:[(0,b.jsx)(h.SelectTrigger,{id:"fileType",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select file type"})}),(0,b.jsx)(h.SelectContent,{children:H.map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{htmlFor:"semester",children:"Semester"}),(0,b.jsxs)(h.Select,{value:ab,onValueChange:a=>ac(a),children:[(0,b.jsx)(h.SelectTrigger,{id:"semester",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select semester"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"Fall",children:"Fall"}),(0,b.jsx)(h.SelectItem,{value:"Spring",children:"Spring"}),(0,b.jsx)(h.SelectItem,{value:"Summer",children:"Summer"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{htmlFor:"academicYear",children:"Academic Year"}),(0,b.jsx)(f.Input,{id:"academicYear",value:ak,onChange:a=>al(a.target.value),placeholder:"2024-2025",required:!0})]})]}),(0,b.jsx)(e.Button,{type:"submit",className:"w-full",children:"Upload File"})]})]})]})]}),(0,b.jsx)("div",{className:"border rounded-lg",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"File Name"}),(0,b.jsx)(i.TableHead,{children:"Course"}),(0,b.jsx)(i.TableHead,{children:"Type"}),(0,b.jsx)(i.TableHead,{children:"Semester"}),(0,b.jsx)(i.TableHead,{children:"Upload Date"}),(0,b.jsx)(i.TableHead,{children:"Size"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(i.TableBody,{children:0===aE.length?(0,b.jsx)(i.TableRow,{children:(0,b.jsx)(i.TableCell,{colSpan:7,className:"text-center text-gray-500 py-8",children:"No files found. Upload your first course file to get started."})}):aE.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsxs)(i.TableCell,{className:"flex items-center gap-2",children:[(0,b.jsx)(l.FileText,{className:"h-4 w-4 text-blue-600"}),(0,b.jsx)("span",{children:a.fileName}),aH[`course-file:${a.id}`]&&(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-red-500"})]}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{children:a.courseCode}),(0,b.jsx)("div",{className:"text-sm text-gray-500",children:a.courseName})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(u.Badge,{variant:"secondary",children:a.fileType})}),(0,b.jsxs)(i.TableCell,{children:[a.semester," ",a.academicYear]}),(0,b.jsx)(i.TableCell,{children:a.uploadDate}),(0,b.jsx)(i.TableCell,{children:a.size}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>aA(a),children:(0,b.jsx)(m.Download,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>az(a.id),children:(0,b.jsx)(n.Trash2,{className:"h-4 w-4 text-red-600"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>{ap(a),ar(!0)},children:(0,b.jsx)(r.Eye,{className:"h-4 w-4 text-blue-600"})})]})})]},a.id))})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4",children:[(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl",children:aE.length}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Total Files"})]})}),(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl",children:A.length}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"File Types"})]})}),(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl",children:aG.length}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Years"})]})})]}),(0,b.jsx)(j.Dialog,{open:aq,onOpenChange:ar,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsx)(j.DialogTitle,{children:"File Details"}),(0,b.jsx)(j.DialogDescription,{children:ao&&(0,b.jsxs)("span",{className:"flex items-center gap-2 mt-2",children:[(0,b.jsx)(l.FileText,{className:"h-4 w-4"}),ao.fileName]})})]}),ao&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Course Code"}),(0,b.jsx)("p",{children:ao.courseCode})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Course Name"}),(0,b.jsx)("p",{children:ao.courseName})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"File Type"}),(0,b.jsx)("p",{children:ao.fileType})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Semester"}),(0,b.jsxs)("p",{children:[ao.semester," ",ao.academicYear]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Upload Date"}),(0,b.jsx)("p",{children:ao.uploadDate})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"File Size"}),(0,b.jsx)("p",{children:ao.size})]})]}),ao.status&&(0,b.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("h4",{className:"flex items-center gap-2",children:[(0,b.jsx)(q.MessageSquare,{className:"h-5 w-5 text-gray-600"}),"Admin Review"]}),(0,b.jsx)(u.Badge,{className:"Approved"===ao.status?"bg-green-100 text-green-800":"Rejected"===ao.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800",children:ao.status})]}),ao.adminRemarks?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(w.Alert,{className:"Approved"===ao.status?"border-green-200 bg-green-50":"Rejected"===ao.status?"border-red-200 bg-red-50":"border-yellow-200 bg-yellow-50",children:(0,b.jsxs)(w.AlertDescription,{children:[(0,b.jsx)("p",{className:"text-sm mb-3",children:ao.adminRemarks}),ao.reviewedBy&&(0,b.jsxs)("div",{className:"text-xs text-gray-600 pt-2 border-t border-gray-200",children:[(0,b.jsxs)("p",{children:["Reviewed by: ",ao.reviewedBy]}),ao.reviewedDate&&(0,b.jsxs)("p",{children:["Date: ",ao.reviewedDate]})]})]})}),ao.facultyResponse?(0,b.jsx)(w.Alert,{className:"border-blue-200 bg-blue-50",children:(0,b.jsxs)(w.AlertDescription,{children:[(0,b.jsx)("p",{className:"text-xs text-blue-800 mb-2",children:"Your Response:"}),(0,b.jsx)("p",{className:"text-sm mb-3",children:ao.facultyResponse}),ao.responseDate&&(0,b.jsx)("div",{className:"text-xs text-gray-600 pt-2 border-t border-gray-200",children:(0,b.jsxs)("p",{children:["Response Date:"," ",ao.responseDate]})})]})}):(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>at(!0),className:"w-full",children:[(0,b.jsx)(s.Reply,{className:"h-4 w-4 mr-2"}),"Respond to Admin Review"]})]}):(0,b.jsx)(w.Alert,{children:(0,b.jsx)(w.AlertDescription,{className:"text-sm text-gray-500",children:"This file is pending admin review. You will be notified once the review is complete."})})]}),(B=ao.id,0===(C=[...aH[`course-file:${B}`]??[]].sort((a,b)=>new Date(a.createdAt??0).getTime()-new Date(b.createdAt??0).getTime())).length?null:(0,b.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("h4",{className:"flex items-center gap-2",children:[(0,b.jsx)(q.MessageSquare,{className:"h-5 w-5 text-gray-600"}),"Auditor Messages"]}),(0,b.jsx)(u.Badge,{variant:"outline",children:C.length})]}),(0,b.jsx)("div",{className:"space-y-3 max-h-[40vh] overflow-y-auto pr-1",children:C.map(a=>(0,b.jsxs)("div",{className:"rounded-md border bg-white p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,b.jsx)("span",{children:a.senderName||a.senderRole||"Message"}),a.createdAt&&(0,b.jsx)("span",{children:new Date(a.createdAt).toLocaleString()})]}),(0,b.jsx)("p",{className:"text-sm text-gray-700 mt-2",children:a.message})]},a.id))}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>av(!0),children:[(0,b.jsx)(s.Reply,{className:"h-4 w-4 mr-2"}),"Reply to Auditor"]})]})),(0,b.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,b.jsxs)(e.Button,{onClick:()=>aA(ao),className:"flex-1",children:[(0,b.jsx)(m.Download,{className:"h-4 w-4 mr-2"}),"Download File"]}),(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>ar(!1),children:"Close"})]})]})]})}),(0,b.jsx)(x.ResponseDialog,{open:as,onOpenChange:at,onSubmit:aB,itemType:"file"}),(0,b.jsx)(x.ResponseDialog,{open:au,onOpenChange:av,onSubmit:aC,itemType:"file"})]}),(0,b.jsx)(y.TabsContent,{value:"all-files",className:"space-y-4 mt-4",children:(0,b.jsx)(af,{files:aD,currentUser:J?.name??"",onFilesChange:E})})]})})]})}a.s(["CourseFileManager",()=>ah],10801)}];

//# sourceMappingURL=src_components_CourseFileManager_index_tsx_04406ba6._.js.map