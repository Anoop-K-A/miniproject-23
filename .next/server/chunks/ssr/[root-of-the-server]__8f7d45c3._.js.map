{"version":3,"sources":["../../../../src/lib/jsonDb.ts","../../../../src/components/faculty/FacultySectionTabs.tsx/__nextjs-internal-proxy.mjs","../../../../src/components/CourseFileManager/index.tsx/__nextjs-internal-proxy.mjs","../../../../src/components/CourseFileManager.tsx","../../../../src/app/%28dashboard%29/faculty/files/page.tsx"],"sourcesContent":["import fs from \"fs/promises\";\r\nimport path from \"path\";\r\n\r\nconst dataRoot = path.join(process.cwd(), \"src\", \"data\");\r\n\r\n// Simple lock mechanism to prevent concurrent writes\r\nconst locks = new Map<string, Promise<void>>();\r\n\r\nexport function getDataFilePath(fileName: string) {\r\n  return path.join(dataRoot, fileName);\r\n}\r\n\r\nexport async function readJsonFile<T>(fileName: string): Promise<T> {\r\n  const filePath = getDataFilePath(fileName);\r\n  const fileContents = await fs.readFile(filePath, \"utf-8\");\r\n  return JSON.parse(fileContents) as T;\r\n}\r\n\r\nexport async function writeJsonFile<T>(fileName: string, data: T) {\r\n  const filePath = getDataFilePath(fileName);\r\n\r\n  // Wait for any existing write operation to complete\r\n  while (locks.has(fileName)) {\r\n    await locks.get(fileName);\r\n  }\r\n\r\n  // Create a new lock for this write operation\r\n  const writeLock = (async () => {\r\n    try {\r\n      const jsonString = JSON.stringify(data, null, 2);\r\n\r\n      // Validate JSON before writing\r\n      try {\r\n        JSON.parse(jsonString);\r\n      } catch (error) {\r\n        console.error(\"Invalid JSON data, aborting write:\", error);\r\n        throw new Error(\"Failed to write JSON: Invalid data structure\");\r\n      }\r\n\r\n      // Write to temporary file first, then rename (atomic operation)\r\n      const tempFilePath = `${filePath}.tmp`;\r\n      await fs.writeFile(tempFilePath, jsonString, \"utf-8\");\r\n      await fs.rename(tempFilePath, filePath);\r\n    } finally {\r\n      locks.delete(fileName);\r\n    }\r\n  })();\r\n\r\n  locks.set(fileName, writeLock);\r\n  await writeLock;\r\n}\r\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const FacultySectionTabs = registerClientReference(\n    function() { throw new Error(\"Attempted to call FacultySectionTabs() from the server but FacultySectionTabs is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/faculty/FacultySectionTabs.tsx\",\n    \"FacultySectionTabs\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const CourseFileManager = registerClientReference(\n    function() { throw new Error(\"Attempted to call CourseFileManager() from the server but CourseFileManager is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/CourseFileManager/index.tsx\",\n    \"CourseFileManager\",\n);\n","// Re-export the refactored CourseFileManager component\r\nexport { CourseFileManager } from \"./CourseFileManager/index\";\r\n\r\n// Re-export types for backward compatibility\r\nexport type { CourseFile, PeerReview } from \"./CourseFileManager/types\";\r\n","import { CourseFileManager } from \"@/components/CourseFileManager\";\r\nimport { FacultySectionTabs } from \"@/components/faculty/FacultySectionTabs\";\r\nimport type { CourseFile } from \"@/components/CourseFileManager/types\";\r\nimport { readJsonFile } from \"@/lib/jsonDb\";\r\n\r\nexport const dynamic = \"force-dynamic\";\r\n\r\nexport default async function FacultyFilesPage() {\r\n  const files = await readJsonFile<CourseFile[]>(\"courseFiles.json\");\r\n  const fileCategories = await readJsonFile<string[]>(\r\n    \"files/course-file-categories.json\",\r\n  );\r\n  const fileTypes = await readJsonFile<string[]>(\r\n    \"files/course-file-types.json\",\r\n  );\r\n\r\n  return (\r\n    <main className=\"space-y-6\">\r\n      <FacultySectionTabs>\r\n        <CourseFileManager\r\n          initialFiles={files}\r\n          fileCategories={fileCategories}\r\n          fileTypes={fileTypes}\r\n        />\r\n      </FacultySectionTabs>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"mcAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEA,IAAM,EAAW,EAAA,OAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,GAAI,MAAO,QAS1C,eAAe,EAAgB,CAAgB,EACpD,IAAM,EAJC,EAAA,OAAI,AAIM,CAJL,IAAI,CAAC,EAIgB,GAEjC,KAN2B,EAMpB,KAAK,KAAK,CADI,AACH,MADS,EAAA,OAAE,CAAC,QAAQ,CAAC,EAAU,SAEnD,uFCdO,IAAM,EAAqB,CAAA,EADlC,AACkC,EADlC,CAAA,CAAA,OACkC,uBAAA,AAAuB,EACrD,WAAa,MAAU,AAAJ,MAAU,kPAAoP,EACjR,8EACA,gFAHG,IAAM,EAAqB,CAAA,EADlC,AACkC,EADlC,CAAA,CAAA,OACkC,uBAAA,AAAuB,EACrD,WAAa,MAAM,AAAI,MAAM,kPAAoP,EACjR,0DACA,0ICHG,IAAM,EAAoB,CAAA,EADjC,AACiC,EADjC,CAAA,CAAA,OACiC,uBAAA,AAAuB,EACpD,WAAa,MAAM,AAAI,MAAM,gPAAkP,EAC/Q,2EACA,8EAHG,IAAM,EAAoB,CAAA,EAAA,AADjC,EAAA,CAAA,CAAA,OACiC,uBAAA,AAAuB,EACpD,WAAa,MAAM,AAAI,MAAM,gPAAkP,EAC/Q,uDACA,wHCJJ,EAAA,EAAA,CAAA,CAAA,OCAA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,OAIe,eAAe,IAC5B,IAAM,EAAQ,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,EAAe,oBACzC,EAAiB,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,EACvC,qCAEI,EAAY,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,EAClC,gCAGF,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,qBACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,kBAAkB,CAAA,UACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,iBAAiB,CAAA,CAChB,aAAc,EACd,eAAgB,EAChB,UAAW,OAKrB,kCAtBuB","ignoreList":[1,2]}