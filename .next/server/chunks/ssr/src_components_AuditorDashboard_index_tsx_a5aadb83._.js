module.exports=[15783,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(91119),e=a.i(99570),f=a.i(86304),g=a.i(210),h=a.i(84505),i=a.i(23292),j=a.i(70430);function k({checklist:a,checkedItems:c,onChecklistChange:f}){return(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsxs)(d.Card,{className:"sticky top-4 h-fit flex flex-col rounded-lg border border-gray-200 shadow-md",children:[(0,b.jsx)(d.CardHeader,{className:"flex-shrink-0 border-b",children:(0,b.jsx)(d.CardTitle,{className:"text-base",children:"Audit Checklist"})}),(0,b.jsx)(d.CardContent,{className:"max-h-[calc(100vh-200px)] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:(0,b.jsx)("div",{className:"space-y-4 pr-2",children:a.map(a=>{let d=c[a.id]||"pending";return(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{className:"text-sm leading-tight",children:a.label}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(e.Button,{size:"sm",variant:"yes"===d?"default":"outline",onClick:()=>f(a.id,"yes"),className:"flex-1 text-xs",children:"Yes"}),(0,b.jsx)(e.Button,{size:"sm",variant:"no"===d?"destructive":"outline",onClick:()=>f(a.id,"no"),className:"flex-1 text-xs",children:"No"}),(0,b.jsx)(e.Button,{size:"sm",variant:"pending"===d?"default":"outline",onClick:()=>f(a.id,"pending"),className:"flex-1 text-xs",children:"Pending"})]})]},a.id)})})}),(0,b.jsx)("div",{className:"flex-shrink-0 pt-4 border-t px-6 pb-4 bg-white",children:(0,b.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Yes:"}),(0,b.jsx)("span",{className:"font-medium",children:Object.values(c).filter(a=>"yes"===a).length})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"No:"}),(0,b.jsx)("span",{className:"font-medium",children:Object.values(c).filter(a=>"no"===a).length})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Pending:"}),(0,b.jsx)("span",{className:"font-medium",children:a.length-Object.keys(c).length+Object.values(c).filter(a=>"pending"===a).length})]})]})})]})})}var l=a.i(4720),m=a.i(41675);function n({type:a,item:c,onDownload:f}){return(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:["file"===a?(0,b.jsx)(l.FileText,{className:"h-5 w-5"}):(0,b.jsx)(m.Calendar,{className:"h-5 w-5"}),"Document Viewer"]})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"aspect-[16/10] bg-gray-100 rounded-lg flex items-center justify-center border-2 border-dashed border-gray-300",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(l.FileText,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"file"===a?`Document: ${c.fileName}`:`Report: ${c.eventName}`}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Live document preview would appear here"}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"mt-4",onClick:f,children:[(0,b.jsx)(h.Download,{className:"h-4 w-4 mr-2"}),"Download Document"]})]})})})]})}function o({type:a,item:c}){return(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Document Details"})}),(0,b.jsx)(d.CardContent,{children:"file"===a?(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"File Type"}),(0,b.jsx)("p",{children:c.fileType})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Upload Date"}),(0,b.jsx)("p",{children:c.uploadDate})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Course Name"}),(0,b.jsx)("p",{children:c.courseName})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Semester"}),(0,b.jsx)("p",{children:c.semester})]})]}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Event Type"}),(0,b.jsx)("p",{children:c.eventType})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Event Date"}),(0,b.jsx)("p",{children:c.eventDate})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Location"}),(0,b.jsx)("p",{children:c.location})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Participants"}),(0,b.jsx)("p",{children:c.participants})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Description"}),(0,b.jsx)("p",{className:"text-sm",children:c.description})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Objectives"}),(0,b.jsx)("p",{className:"text-sm",children:c.objectives})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Outcomes & Impact"}),(0,b.jsx)("p",{className:"text-sm",children:c.outcomes})]})]})})]})}var p=a.i(29246),q=a.i(70106);let r=(0,q.default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var s=a.i(62722);function t({type:a,auditorRemarks:c,onRemarksChange:f,reviewDecision:g,onDecisionChange:h,onSubmit:j,checklist:k,checkedItems:l}){return(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Auditor Remarks"})}),(0,b.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,b.jsx)(p.Textarea,{placeholder:"Provide detailed feedback and remarks...",value:c,onChange:a=>f(a.target.value),rows:6}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsxs)(e.Button,{variant:"approve"===g?"default":"outline",onClick:()=>h("approve"),className:"flex-1",children:[(0,b.jsx)(r,{className:"h-4 w-4 mr-2"}),"Approve"]}),(0,b.jsxs)(e.Button,{variant:"reject"===g?"destructive":"outline",onClick:()=>h("reject"),className:"flex-1",children:[(0,b.jsx)(s.XCircle,{className:"h-4 w-4 mr-2"}),"Reject"]})]}),(0,b.jsx)(e.Button,{onClick:()=>{g?k.every(a=>l[a.id])?c.trim()?j():i.toast.error("Please provide auditor remarks"):i.toast.error("Please complete all checklist items"):i.toast.error("Please select approve or reject")},className:"w-full",size:"lg",children:"Submit Review"})]})]})}var u=a.i(56025),v=a.i(21562);let w=[{id:"co_po_mapping",label:"CO–PO Mapping (CO–PO Mapping Level)"},{id:"co_pso_mapping",label:"CO–PO Mapping (CO–PSO Mapping Level)"},{id:"justification",label:"Justification of Mapping"},{id:"course_coverage",label:"Course File Coverage"},{id:"test_qp",label:"Test (QP)"},{id:"test_co_level",label:"Test (CO Level)"},{id:"test_sample_answer",label:"Test (Sample Answer Sheets)"},{id:"test_qp_second",label:"Test (QP) – Second"},{id:"test_co_level_second",label:"Test (CO Level) – Second"},{id:"test_sample_answer_second",label:"Test (Sample Answer Sheets) – Second"},{id:"assignment_qp",label:"Assignment (QP)"},{id:"assignment_co_level",label:"Assignment (CO Level)"},{id:"assignment_sample",label:"Assignment (Sample)"},{id:"assignment_qp_second",label:"Assignment (QP) – Second"},{id:"assignment_co_level_second",label:"Assignment (CO Level) – Second"},{id:"assignment_sample_second",label:"Assignment (Sample) – Second"},{id:"sample_tutorial",label:"Sample Tutorial"},{id:"attendance",label:"Attendance (%)"},{id:"internal_marks",label:"Internal Marks Display"},{id:"course_exit_survey",label:"Course Exit Survey"},{id:"attainment_calculation",label:"Attainment Calculation"},{id:"remarks",label:"Remarks"},{id:"score",label:"Score (Faculty/Auditor)"}],x=[{id:"details",label:"Event details are complete and accurate"}];function y({type:a,item:j,facultyName:l,facultyId:m,onBack:p,onReviewCompleted:q}){let[r,s]=(0,c.useState)({}),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(null),{user:C}=(0,u.useAuth)(),D="file"===a?w:x,E=async()=>{if(!A)return void i.toast.error("Please select approve or reject");let b="approve"===A?"Approved":"Rejected",c=new Date().toISOString().split("T")[0],d=C?.name??"Auditor";try{let e=await fetch("file"===a?`/api/course-files/${j.id}`:`/api/event-reports/${j.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:b,adminRemarks:y,reviewedBy:d,reviewedDate:c})}),f=await e.json();if(!e.ok)return void i.toast.error(f.error||"Review update failed");let g=("file"===a?f.files:f.reports).filter(a=>a.id===j.id).reduce((a,b)=>a??b,void 0);if(g&&q?.(g),await fetch("/api/audits",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auditorId:C?.id,entityType:"file"===a?"course-file":"event-report",entityId:j.id,status:"approve"===A?"completed":"rejected",remarks:y})}),await fetch("/api/remarks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({authorId:C?.id,entityType:"file"===a?"course-file":"event-report",entityId:j.id,status:"published",text:y})}),m){let c=`${"file"===a?"course-file":"event-report"}:${j.id}`;await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({facultyId:m,auditorId:C?.id,entityType:"file"===a?"course-file":"event-report",entityId:j.id,threadId:c,senderRole:"auditor",senderName:C?.name,message:y||`${"file"===a?"Course file":"Event report"} ${b.toLowerCase()}.`,status:b.toLowerCase()})})}i.toast.success(`${"file"===a?"Course file":"Event report"} ${A}d successfully`),p()}catch(a){console.error("Review submit error:",a),i.toast.error("Failed to submit review")}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(e.Button,{variant:"outline",onClick:p,children:[(0,b.jsx)(g.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to Faculty List"]}),(0,b.jsxs)(e.Button,{variant:"outline",onClick:()=>{let b="Checklist Item,Status\n";D.forEach(a=>{let c=r[a.id]||"pending";b+=`"${a.label}",${c}
`});let c=new Blob([b+=`
Remarks,"${y}"
Decision,${A||"pending"}
`],{type:"text/csv"}),d=window.URL.createObjectURL(c),e=document.createElement("a");e.href=d;let f="file"===a?j.fileName:j.eventName?.replace(/ /g,"_")||"report";e.download=`audit-${l.replace(/ /g,"_")}-${f}.csv`,e.click(),window.URL.revokeObjectURL(d),i.toast.success("Audit sheet downloaded successfully")},children:[(0,b.jsx)(h.Download,{className:"h-4 w-4 mr-2"}),"Download Audit Sheet"]})]}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-medium",children:l}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"file"===a?"Course File Review":"Event Report Review"})]}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)(f.Badge,{className:"approve"===A?"bg-green-100 text-green-800":"",variant:"approve"===A?"default":"outline",children:"approve"===A?"Approved":"Not Approved"})})]})})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,b.jsx)(k,{checklist:D,checkedItems:r,onChecklistChange:(a,b)=>{s({...r,[a]:b})}}),(0,b.jsxs)("div",{className:"lg:col-span-3 space-y-6",children:[(0,b.jsx)(n,{type:a,item:j,onDownload:()=>{if("file"===a){let a=(0,v.sanitizeFileName)(j.fileName,"course-file");if(j.documentUrl){(0,v.downloadFromDataUrl)(j.documentUrl,a),i.toast.success(`Downloading ${j.fileName}`);return}let b=a.replace(/\.[^/.]+$/,""),c=`${b||"course-file"}-summary.txt`,d=`File Name: ${j.fileName}
Document data is not available in storage.`;(0,v.downloadTextFile)(d,c),i.toast.success(`Downloaded summary for ${j.fileName}`);return}let b=(0,v.sanitizeFileName)(j.eventName,"event-report"),c=`${b||"event-report"}.json`;(0,v.downloadJsonFile)(j,c),i.toast.success(`Downloading ${j.eventName}`)}}),(0,b.jsx)(o,{type:a,item:j}),(0,b.jsx)(t,{type:a,item:j,auditorRemarks:y,onRemarksChange:z,reviewDecision:A,onDecisionChange:B,onSubmit:E,checklist:D,checkedItems:r})]})]})]})}function z({onBack:a}){return(0,b.jsxs)(e.Button,{variant:"outline",onClick:a,children:[(0,b.jsx)(g.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to Faculty List"]})}function A({faculty:a}){return(0,b.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"h-16 w-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-2xl font-semibold",children:a.name.split(" ").map(a=>a[0]).join("")}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:a.name}),(0,b.jsx)("p",{className:"text-gray-600",children:a.department}),(0,b.jsxs)("div",{className:"flex items-center gap-4 mt-2",children:[(0,b.jsxs)(f.Badge,{variant:"outline",children:[a.totalFiles," Course Files"]}),(0,b.jsxs)(f.Badge,{variant:"outline",children:[a.totalReports," Event Reports"]})]})]})]})})}var B=a.i(75083),C=a.i(3314);function D({report:a,onReview:c,getStatusColor:g}){return(0,b.jsx)(d.Card,{className:"hover:shadow-lg transition-shadow",children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 flex-1",children:[(0,b.jsx)("div",{className:"h-10 w-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(m.Calendar,{className:"h-5 w-5 text-green-600"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium line-clamp-1",children:a.eventName}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.location})]})]}),(0,b.jsx)(f.Badge,{className:g(a.status),children:a.status})]}),(0,b.jsx)("div",{className:"flex items-center justify-between text-sm",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Badge,{variant:"outline",children:a.eventType}),(0,b.jsxs)("span",{className:"text-gray-500",children:[a.participants," participants"]})]})}),a.auditorRemarks&&(0,b.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-green-800 mb-1",children:"Auditor Remarks:"}),(0,b.jsx)("p",{className:"text-sm text-green-700",children:a.auditorRemarks})]}),(0,b.jsxs)(e.Button,{variant:"Submitted"===a.status?"default":"outline",size:"sm",onClick:()=>c(a),className:"w-full",children:[(0,b.jsx)(C.Shield,{className:"h-4 w-4 mr-2"}),"Submitted"===a.status?"Review & Audit":"View Review"]})]})})})}var E=a.i(77156),F=a.i(67453),G=a.i(41710),H=a.i(92e3),I=a.i(5784),J=a.i(50522);function K({courseFiles:a,onReviewFile:g,getStatusColor:h}){let i,[j,k]=(0,c.useState)(new Set),n=(i={},a.forEach(a=>{let b=a.courseCode||"Unknown";i[b]||(i[b]=[]),i[b].push(a)}),i),o=Object.keys(n).sort();return 0===o.length?(0,b.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,b.jsx)(l.FileText,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,b.jsx)("p",{children:"No course files available yet."})]}):(0,b.jsx)("div",{className:"space-y-6",children:o.map(a=>{let c=n[a],i=c.filter(a=>"Approved"===a.status).length;c.filter(a=>"Pending"===a.status||"Submitted"===a.status).length;let o=c.filter(a=>"Rejected"===a.status).length,p=c.filter(a=>"Submitted"===a.status||"Pending"===a.status).length,q=c[0]?.courseName||a,r=j.has(a);return(0,b.jsxs)(d.Card,{className:"border-l-4 border-l-purple-500 hover:shadow-lg transition-shadow",children:[(0,b.jsx)(d.CardHeader,{className:"pb-3 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>{k(b=>{let c=new Set(b);return c.has(a)?c.delete(a):c.add(a),c})},children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[r?(0,b.jsx)(I.ChevronDown,{className:"h-5 w-5 text-gray-600"}):(0,b.jsx)(J.ChevronRight,{className:"h-5 w-5 text-gray-600"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(d.CardTitle,{className:"text-xl font-bold text-gray-900",children:a}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:q})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[(0,b.jsxs)(f.Badge,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[c.length," ",1===c.length?"File":"Files"]}),p>0&&(0,b.jsxs)(f.Badge,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:[(0,b.jsx)(H.AlertCircle,{className:"h-3 w-3 mr-1"}),p," To Review"]}),i>0&&(0,b.jsxs)(f.Badge,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[(0,b.jsx)(F.CheckCircle2,{className:"h-3 w-3 mr-1"}),i]}),o>0&&(0,b.jsxs)(f.Badge,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:[(0,b.jsx)(s.XCircle,{className:"h-3 w-3 mr-1"}),o]})]})]})}),r&&(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:c.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors border border-gray-200",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(a=>{switch(a){case"Approved":return(0,b.jsx)(F.CheckCircle2,{className:"h-4 w-4 text-green-600"});case"Rejected":return(0,b.jsx)(s.XCircle,{className:"h-4 w-4 text-red-600"});case"Pending":case"Submitted":return(0,b.jsx)(G.Clock,{className:"h-4 w-4 text-yellow-600"});default:return(0,b.jsx)(l.FileText,{className:"h-4 w-4 text-gray-600"})}})(a.status),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-gray-900 truncate",children:a.fileName}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-500",children:[(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(l.FileText,{className:"h-3 w-3"}),a.fileType]}),(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(m.Calendar,{className:"h-3 w-3"}),new Date(a.uploadDate).toLocaleDateString()]}),a.semester&&(0,b.jsx)("span",{children:a.semester})]}),a.auditorRemarks&&(0,b.jsxs)("p",{className:"text-xs text-gray-600 mt-1 italic",children:["Remarks: ",a.auditorRemarks]})]}),(0,b.jsx)(f.Badge,{className:h(a.status),children:a.status})]}),(0,b.jsx)("div",{className:"flex items-center gap-2 ml-3",children:(0,b.jsxs)(e.Button,{size:"sm",variant:"Submitted"===a.status||"Pending"===a.status?"default":"outline",onClick:()=>g(a),className:"h-8 px-3",children:[(0,b.jsx)(E.Eye,{className:"h-4 w-4 mr-1"}),"Submitted"===a.status||"Pending"===a.status?"Review":"View"]})})]},a.id))})})]},a)})})}function L({courseFiles:a,eventReports:c,onReviewFile:d,onReviewReport:e,getStatusColor:f}){return(0,b.jsxs)(B.Tabs,{defaultValue:"course-files",children:[(0,b.jsxs)(B.TabsList,{className:"grid w-full grid-cols-2",children:[(0,b.jsxs)(B.TabsTrigger,{value:"course-files",children:[(0,b.jsx)(l.FileText,{className:"h-4 w-4 mr-2"}),"Course Files"]}),(0,b.jsxs)(B.TabsTrigger,{value:"event-reports",children:[(0,b.jsx)(m.Calendar,{className:"h-4 w-4 mr-2"}),"Event Reports"]})]}),(0,b.jsx)(B.TabsContent,{value:"course-files",className:"space-y-4 mt-6",children:(0,b.jsx)(K,{courseFiles:a,onReviewFile:d,getStatusColor:f})}),(0,b.jsx)(B.TabsContent,{value:"event-reports",className:"space-y-4 mt-6",children:(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(a=>(0,b.jsx)(D,{report:a,onReview:e,getStatusColor:f},a.id))})})]})}var M=a.i(33483);function N({faculty:a,onBack:g}){let{user:h}=(0,u.useAuth)(),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)("file"),[v,w]=(0,c.useState)([]),[x,B]=(0,c.useState)([]),[C,D]=(0,c.useState)([]),E=Object.entries(C.reduce((a,b)=>{let c=b.threadId??`${b.entityType}:${b.entityId}`;return a[c]||(a[c]=[]),a[c].push({...b,threadId:c}),a},{})).map(([a,b])=>{let c=[...b].sort((a,b)=>{let c=new Date(a.createdAt??0).getTime();return new Date(b.createdAt??0).getTime()-c}),d=c[c.length-1];return{threadId:a,messages:c,lastMessage:d}}).sort((a,b)=>{let c=new Date(a.lastMessage?.createdAt??0).getTime();return new Date(b.lastMessage?.createdAt??0).getTime()-c}),F=v.reduce((a,b)=>(a[b.id]=b.fileName,a),{}),G=x.reduce((a,b)=>(a[b.id]=b.eventName,a),{}),H=E.reduce((a,b)=>{if(b.lastMessage?.entityType!=="course-file")return a;let c=b.lastMessage.entityId,d=F[c]??"Course File";return a[c]||(a[c]={fileId:c,fileName:d,threads:[]}),a[c].threads.push(b),a},{});Object.values(H).forEach(a=>{a.threads.sort((a,b)=>{let c=new Date(a.lastMessage?.createdAt??0).getTime();return new Date(b.lastMessage?.createdAt??0).getTime()-c})});let I=E.reduce((a,b)=>{if(b.lastMessage?.entityType!=="event-report")return a;let c=b.lastMessage.entityId,d=G[c]??"Event Report";return a[c]||(a[c]={reportId:c,reportName:d,threads:[]}),a[c].threads.push(b),a},{});Object.values(I).forEach(a=>{a.threads.sort((a,b)=>{let c=new Date(a.lastMessage?.createdAt??0).getTime();return new Date(b.lastMessage?.createdAt??0).getTime()-c})});let J=Object.values(H).sort((a,b)=>{let c=a.threads[0]?.lastMessage?.createdAt??0;return new Date(b.threads[0]?.lastMessage?.createdAt??0).getTime()-new Date(c).getTime()}),K=Object.values(I).sort((a,b)=>{let c=a.threads[0]?.lastMessage?.createdAt??0;return new Date(b.threads[0]?.lastMessage?.createdAt??0).getTime()-new Date(c).getTime()});(0,c.useEffect)(()=>{(async()=>{try{let[b,c,d]=await Promise.all([fetch("/api/course-files"),fetch("/api/event-reports"),fetch(`/api/messages?facultyId=${a.id}`)]),e=await b.json(),f=await c.json(),g=await d.json();if(!b.ok||!c.ok||!d.ok)return;let h=(e.files??[]).filter(b=>b.facultyId===a.id),i=(f.reports??[]).filter(b=>b.facultyId===a.id);w(h),B(i),D(g.messages??[])}catch(a){console.error("Load faculty portfolio error:",a)}})()},[a.id]);let N=E.find(a=>a.threadId===k)??null,O=async b=>{if(!h?.id||!N)return;let c=N.messages[0];await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({facultyId:a.id,auditorId:h.id,entityType:c.entityType,entityId:c.entityId,threadId:N.threadId,senderRole:"auditor",senderName:h.name,message:b})})},P=async a=>{await fetch(`/api/messages?threadId=${a}`,{method:"DELETE"})};return q&&(m||o)?(0,b.jsx)(y,{type:s,item:"file"===s?m:o,facultyName:a.name,facultyId:a.id,onBack:()=>r(!1),onReviewCompleted:a=>{"file"===s?(w(b=>b.map(b=>b.id===a.id?a:b)),n(a)):(B(b=>b.map(b=>b.id===a.id?a:b)),p(a))}}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(z,{onBack:g}),(0,b.jsx)(A,{faculty:a}),(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"pt-6 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Auditor Messages"}),(0,b.jsx)(f.Badge,{variant:"outline",children:E.length})]}),0===J.length&&0===K.length?(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"No messages yet."}):(0,b.jsxs)("div",{className:"space-y-3",children:[J.map(a=>(0,b.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.fileName}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Course File"})]}),(0,b.jsx)(f.Badge,{variant:"outline",children:a.threads.reduce((a,b)=>a+b.messages.length,0)})]}),(0,b.jsx)("div",{className:"mt-3 space-y-3",children:a.threads.map(a=>(0,b.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:"Thread"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a.lastMessage?.status&&(0,b.jsx)(f.Badge,{variant:"secondary",children:a.lastMessage.status}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>{l(a.threadId),j(!0)},children:"Reply"}),(0,b.jsx)(e.Button,{size:"sm",onClick:()=>P(a.threadId),children:"OK"})]})]}),(0,b.jsx)("div",{className:"mt-3 space-y-2",children:a.messages.map(a=>(0,b.jsxs)("div",{className:"rounded-md bg-white p-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,b.jsx)("span",{children:a.senderName||a.senderRole||"Message"}),a.createdAt&&(0,b.jsx)("span",{children:new Date(a.createdAt).toLocaleString()})]}),(0,b.jsx)("p",{className:"text-sm text-gray-700 mt-1",children:a.message})]},a.id))})]},a.threadId))})]},a.fileId)),K.map(a=>(0,b.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.reportName}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Event Report"})]}),(0,b.jsx)(f.Badge,{variant:"outline",children:a.threads.reduce((a,b)=>a+b.messages.length,0)})]}),(0,b.jsx)("div",{className:"mt-3 space-y-3",children:a.threads.map(a=>(0,b.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:"Thread"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a.lastMessage?.status&&(0,b.jsx)(f.Badge,{variant:"secondary",children:a.lastMessage.status}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>{l(a.threadId),j(!0)},children:"Reply"}),(0,b.jsx)(e.Button,{size:"sm",onClick:()=>P(a.threadId),children:"OK"})]})]}),(0,b.jsx)("div",{className:"mt-3 space-y-2",children:a.messages.map(a=>(0,b.jsxs)("div",{className:"rounded-md bg-white p-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,b.jsx)("span",{children:a.senderName||a.senderRole||"Message"}),a.createdAt&&(0,b.jsx)("span",{children:new Date(a.createdAt).toLocaleString()})]}),(0,b.jsx)("p",{className:"text-sm text-gray-700 mt-1",children:a.message})]},a.id))})]},a.threadId))})]},a.reportId))]})]})}),(0,b.jsx)(L,{courseFiles:v,eventReports:x,onReviewFile:a=>{n(a),t("file"),r(!0)},onReviewReport:a=>{p(a),t("report"),r(!0)},getStatusColor:a=>{switch(a){case"Approved":return"bg-green-100 text-green-800";case"Pending":return"bg-yellow-100 text-yellow-800";case"Submitted":return"bg-blue-100 text-blue-800";case"Draft":default:return"bg-gray-100 text-gray-800";case"Rejected":return"bg-red-100 text-red-800"}}}),(0,b.jsx)(M.ResponseDialog,{open:i,onOpenChange:j,onSubmit:O,itemType:N?.lastMessage?.entityType==="course-file"?"file":"report"})]})}function O(){return(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-12 w-12 bg-orange-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(C.Shield,{className:"h-6 w-6 text-orange-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{children:"Auditor Dashboard"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Quality Assurance & Compliance Review"})]})]})}var P=a.i(60246);function Q({stats:a}){return(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Total Faculty"}),(0,b.jsx)("div",{className:"text-2xl mt-1",children:a.totalFaculty})]}),(0,b.jsx)("div",{className:"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(P.Users,{className:"h-6 w-6 text-blue-600"})})]})})}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Total Course Files"}),(0,b.jsx)("div",{className:"text-2xl mt-1",children:a.totalFiles}),(0,b.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:[a.approvedFiles," approved"]})]}),(0,b.jsx)("div",{className:"h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(l.FileText,{className:"h-6 w-6 text-green-600"})})]})})}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Total Event Reports"}),(0,b.jsx)("div",{className:"text-2xl mt-1",children:a.totalReports}),(0,b.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:[a.approvedReports," approved"]})]}),(0,b.jsx)("div",{className:"h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(m.Calendar,{className:"h-6 w-6 text-purple-600"})})]})})}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Pending Reviews"}),(0,b.jsx)("div",{className:"text-2xl mt-1",children:a.pendingFiles+a.pendingReports}),(0,b.jsx)("p",{className:"text-xs text-orange-600 mt-1",children:"Requires attention"})]}),(0,b.jsx)("div",{className:"h-12 w-12 bg-orange-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(H.AlertCircle,{className:"h-6 w-6 text-orange-600"})})]})})})]})}var R=a.i(24348);function S({stats:a}){let c=a.pendingFiles+a.pendingReports;return 0===c?null:(0,b.jsxs)(R.Alert,{className:"bg-orange-50 border-orange-200",children:[(0,b.jsx)(H.AlertCircle,{className:"h-4 w-4 text-orange-600"}),(0,b.jsxs)(R.AlertDescription,{children:["You have ",c," pending items awaiting review and approval."]})]})}function T({stats:a}){let c=a.approvedFiles+a.rejectedFiles,e=a.approvedReports+a.rejectedReports,f=c>0?Math.round(a.approvedFiles/c*100):0,g=e>0?Math.round(a.approvedReports/e*100):0;return(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Review Statistics"}),(0,b.jsx)(d.CardDescription,{children:"Overall submission quality metrics"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm",children:"Course Files Approved"}),(0,b.jsxs)("span",{className:"text-sm font-medium",children:[f,"%"]})]}),(0,b.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,b.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${f}%`}})}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600 mt-2",children:[(0,b.jsxs)("span",{children:["Approved: ",a.approvedFiles]}),(0,b.jsxs)("span",{children:["Rejected: ",a.rejectedFiles]}),(0,b.jsxs)("span",{children:["Pending: ",a.pendingFiles]}),(0,b.jsxs)("span",{children:["Total: ",a.totalFiles]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm",children:"Event Reports Approved"}),(0,b.jsxs)("span",{className:"text-sm font-medium",children:[g,"%"]})]}),(0,b.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,b.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${g}%`}})}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600 mt-2",children:[(0,b.jsxs)("span",{children:["Approved: ",a.approvedReports]}),(0,b.jsxs)("span",{children:["Rejected: ",a.rejectedReports]}),(0,b.jsxs)("span",{children:["Pending: ",a.pendingReports]}),(0,b.jsxs)("span",{children:["Total: ",a.totalReports]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm",children:"Overall Completion Rate"}),(0,b.jsxs)("span",{className:"text-sm font-medium",children:[a.completionRate,"%"]})]}),(0,b.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,b.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${a.completionRate}%`}})})]})]})})]})}function U({reviews:a}){return(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Recent Review Activity"}),(0,b.jsx)(d.CardDescription,{children:"Your latest review actions"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:a.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-start gap-3 pb-3 border-b last:border-0",children:[(0,b.jsx)("div",{className:"h-2 w-2 rounded-full bg-orange-600 mt-2"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("p",{className:"text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:a.action})," ",a.item]}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[a.faculty," • ",a.time]})]})]},c))})})]})}let V=(0,q.default)("clipboard-check",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);function W({faculty:a}){return(0,b.jsxs)("div",{className:"flex items-center gap-6",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Course Files"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(f.Badge,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[(0,b.jsx)(r,{className:"h-3 w-3 mr-1"}),a.approvedFiles]}),a.pendingFiles>0&&(0,b.jsxs)(f.Badge,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:[(0,b.jsx)(H.AlertCircle,{className:"h-3 w-3 mr-1"}),a.pendingFiles]})]})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Event Reports"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(f.Badge,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[(0,b.jsx)(r,{className:"h-3 w-3 mr-1"}),a.approvedReports]}),a.pendingReports>0&&(0,b.jsxs)(f.Badge,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:[(0,b.jsx)(H.AlertCircle,{className:"h-3 w-3 mr-1"}),a.pendingReports]})]})]})]})}function X({faculty:a,onClick:c}){return(0,b.jsx)(d.Card,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>c(a),children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,b.jsx)("div",{className:"h-12 w-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white flex-shrink-0",children:a.name.split(" ").map(a=>a[0]).join("")}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium",children:a.name}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:a.department})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-6",children:[(0,b.jsx)(W,{faculty:a}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(E.Eye,{className:"h-4 w-4 mr-2"}),"Review",(0,b.jsx)(J.ChevronRight,{className:"h-4 w-4 ml-2"})]})]})]})})})}function Y({facultyMembers:a,onSelectFaculty:c}){return(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(V,{className:"h-5 w-5"}),"Faculty Submission Status"]}),(0,b.jsx)(d.CardDescription,{children:"Review and audit faculty course files and event reports"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:a.map(a=>(0,b.jsx)(X,{faculty:a,onClick:c},a.id))})})]})}function Z({stats:a,facultyMembers:d,recentReviews:e}){let[f,g]=(0,c.useState)(null),[h,i]=(0,c.useState)(a),[j,k]=(0,c.useState)(d),[l,m]=(0,c.useState)(e);return((0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/dashboard/auditor"),b=await a.json();if(!a.ok)return;b?.stats&&i(b.stats),b?.facultyMembers&&k(b.facultyMembers),b?.recentReviews&&m(b.recentReviews)}catch(a){console.error("Auditor dashboard refresh error:",a)}})()},[]),f)?(0,b.jsx)(N,{faculty:f,onBack:()=>g(null)}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(O,{}),(0,b.jsx)(Q,{stats:h}),(0,b.jsx)(S,{stats:h}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,b.jsx)(T,{stats:h}),(0,b.jsx)(U,{reviews:l})]}),(0,b.jsx)(Y,{facultyMembers:j,onSelectFaculty:g})]})}a.s(["AuditorDashboard",()=>Z],15783)}];

//# sourceMappingURL=src_components_AuditorDashboard_index_tsx_a5aadb83._.js.map