{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/anoop/miniproject-23/src/lib/jsonDb.ts"],"sourcesContent":["import fs from \"fs/promises\";\r\nimport path from \"path\";\r\n\r\nconst dataRoot = path.join(process.cwd(), \"src\", \"data\");\r\n\r\nexport function getDataFilePath(fileName: string) {\r\n  return path.join(dataRoot, fileName);\r\n}\r\n\r\nexport async function readJsonFile<T>(fileName: string): Promise<T> {\r\n  const filePath = getDataFilePath(fileName);\r\n  const fileContents = await fs.readFile(filePath, \"utf-8\");\r\n  return JSON.parse(fileContents) as T;\r\n}\r\n\r\nexport async function writeJsonFile<T>(fileName: string, data: T) {\r\n  const filePath = getDataFilePath(fileName);\r\n  await fs.writeFile(filePath, JSON.stringify(data, null, 2));\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEA,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,OAAO;AAE1C,SAAS,gBAAgB,QAAgB;IAC9C,OAAO,4GAAI,CAAC,IAAI,CAAC,UAAU;AAC7B;AAEO,eAAe,aAAgB,QAAgB;IACpD,MAAM,WAAW,gBAAgB;IACjC,MAAM,eAAe,MAAM,gIAAE,CAAC,QAAQ,CAAC,UAAU;IACjD,OAAO,KAAK,KAAK,CAAC;AACpB;AAEO,eAAe,cAAiB,QAAgB,EAAE,IAAO;IAC9D,MAAM,WAAW,gBAAgB;IACjC,MAAM,gIAAE,CAAC,SAAS,CAAC,UAAU,KAAK,SAAS,CAAC,MAAM,MAAM;AAC1D"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/anoop/miniproject-23/src/app/api/users/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { readJsonFile, writeJsonFile } from \"@/lib/jsonDb\";\r\nimport type { Student } from \"@/components/StaffAdvisorDashboard/types\";\r\n\r\ninterface UserRecord {\r\n  id: string;\r\n  username: string;\r\n  password: string;\r\n  name: string;\r\n  role: \"faculty\" | \"auditor\" | \"staff-advisor\" | \"admin\" | string;\r\n  roles?: (\"faculty\" | \"auditor\" | \"staff-advisor\" | \"admin\")[];\r\n  department?: string;\r\n  email?: string;\r\n  phone?: string;\r\n  status?: string;\r\n  createdAt?: string;\r\n  updatedAt?: string;\r\n}\r\n\r\ninterface CourseFileRecord {\r\n  id: string;\r\n  facultyId: string;\r\n}\r\n\r\ninterface EventReportRecord {\r\n  id: string;\r\n  facultyId: string;\r\n}\r\n\r\ninterface AuditRecord {\r\n  id: string;\r\n  auditorId: string;\r\n  entityType: string;\r\n  entityId: string;\r\n}\r\n\r\ninterface RemarkRecord {\r\n  id: string;\r\n  authorId: string;\r\n  entityType: string;\r\n  entityId: string;\r\n}\r\n\r\ninterface EngagementRecord {\r\n  id: string;\r\n  facultyId: string;\r\n  score: number;\r\n  [key: string]: any;\r\n}\r\n\r\nexport async function PATCH(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> },\r\n) {\r\n  try {\r\n    const { id } = await params;\r\n    const payload = await request.json();\r\n    const users = await readJsonFile<UserRecord[]>(\"users.json\");\r\n    const updatedAt = new Date().toISOString();\r\n\r\n    const updatedUsers = users.map((user) =>\r\n      user.id === id\r\n        ? {\r\n            ...user,\r\n            ...payload,\r\n            updatedAt,\r\n          }\r\n        : user,\r\n    );\r\n\r\n    await writeJsonFile(\"users.json\", updatedUsers);\r\n    return NextResponse.json({ users: updatedUsers });\r\n  } catch (error) {\r\n    console.error(\"User update error:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to update user\" },\r\n      { status: 500 },\r\n    );\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  _request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> },\r\n) {\r\n  try {\r\n    const { id } = await params;\r\n    const users = await readJsonFile<UserRecord[]>(\"users.json\");\r\n    const courseFiles =\r\n      await readJsonFile<CourseFileRecord[]>(\"courseFiles.json\");\r\n    const eventReports =\r\n      await readJsonFile<EventReportRecord[]>(\"eventReports.json\");\r\n    const audits = await readJsonFile<AuditRecord[]>(\"audits.json\");\r\n    const remarks = await readJsonFile<RemarkRecord[]>(\"remarks.json\");\r\n    const students = await readJsonFile<Student[]>(\"students.json\");\r\n    const engagements = await readJsonFile<EngagementRecord[]>(\r\n      \"engagements.json\",\r\n    ).catch(() => []);\r\n\r\n    const updatedUsers = users.filter((user) => user.id !== id);\r\n\r\n    const removedFileIds = courseFiles\r\n      .filter((file) => file.facultyId === id)\r\n      .map((file) => file.id);\r\n    const removedReportIds = eventReports\r\n      .filter((report) => report.facultyId === id)\r\n      .map((report) => report.id);\r\n\r\n    const updatedFiles = courseFiles.filter((file) => file.facultyId !== id);\r\n    const updatedReports = eventReports.filter(\r\n      (report) => report.facultyId !== id,\r\n    );\r\n\r\n    const updatedAudits = audits.filter(\r\n      (audit) =>\r\n        audit.auditorId !== id &&\r\n        !(\r\n          (audit.entityType === \"course-file\" &&\r\n            removedFileIds.includes(audit.entityId)) ||\r\n          (audit.entityType === \"event-report\" &&\r\n            removedReportIds.includes(audit.entityId))\r\n        ),\r\n    );\r\n\r\n    const updatedRemarks = remarks.filter(\r\n      (remark) =>\r\n        remark.authorId !== id &&\r\n        !(\r\n          (remark.entityType === \"course-file\" &&\r\n            removedFileIds.includes(remark.entityId)) ||\r\n          (remark.entityType === \"event-report\" &&\r\n            removedReportIds.includes(remark.entityId))\r\n        ),\r\n    );\r\n\r\n    const updatedStudents = students.filter(\r\n      (student) => student.advisorId !== id,\r\n    );\r\n\r\n    const updatedEngagements = engagements.filter(\r\n      (engagement) => engagement.facultyId !== id,\r\n    );\r\n\r\n    await writeJsonFile(\"users.json\", updatedUsers);\r\n    await writeJsonFile(\"courseFiles.json\", updatedFiles);\r\n    await writeJsonFile(\"eventReports.json\", updatedReports);\r\n    await writeJsonFile(\"audits.json\", updatedAudits);\r\n    await writeJsonFile(\"remarks.json\", updatedRemarks);\r\n    await writeJsonFile(\"students.json\", updatedStudents);\r\n    await writeJsonFile(\"engagements.json\", updatedEngagements);\r\n\r\n    return NextResponse.json({ users: updatedUsers });\r\n  } catch (error) {\r\n    console.error(\"User delete error:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to delete user\" },\r\n      { status: 500 },\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}