(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,68349,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(15288),r=e.i(19455),i=e.i(87486),l=e.i(71689),n=e.i(40160),d=e.i(46696),c=e.i(10204);function o({checklist:e,checkedItems:t,onChecklistChange:i}){return(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)(a.Card,{className:"sticky top-4",children:[(0,s.jsx)(a.CardHeader,{children:(0,s.jsx)(a.CardTitle,{className:"text-base",children:"Audit Checklist"})}),(0,s.jsx)(a.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[e.map(e=>{let a=t[e.id]||"pending";return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(c.Label,{className:"text-sm leading-tight",children:e.label}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(r.Button,{size:"sm",variant:"yes"===a?"default":"outline",onClick:()=>i(e.id,"yes"),className:"flex-1 text-xs",children:"Yes"}),(0,s.jsx)(r.Button,{size:"sm",variant:"no"===a?"destructive":"outline",onClick:()=>i(e.id,"no"),className:"flex-1 text-xs",children:"No"}),(0,s.jsx)(r.Button,{size:"sm",variant:"pending"===a?"default":"outline",onClick:()=>i(e.id,"pending"),className:"flex-1 text-xs",children:"Pending"})]})]},e.id)}),(0,s.jsx)("div",{className:"pt-4 border-t",children:(0,s.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"Yes:"}),(0,s.jsx)("span",{className:"font-medium",children:Object.values(t).filter(e=>"yes"===e).length})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"No:"}),(0,s.jsx)("span",{className:"font-medium",children:Object.values(t).filter(e=>"no"===e).length})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"Pending:"}),(0,s.jsx)("span",{className:"font-medium",children:e.length-Object.keys(t).length+Object.values(t).filter(e=>"pending"===e).length})]})]})})]})})]})})}var m=e.i(78583),x=e.i(87316);function h({type:e,item:t,onDownload:i}){return(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{children:(0,s.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:["file"===e?(0,s.jsx)(m.FileText,{className:"h-5 w-5"}):(0,s.jsx)(x.Calendar,{className:"h-5 w-5"}),"Document Viewer"]})}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)("div",{className:"aspect-[16/10] bg-gray-100 rounded-lg flex items-center justify-center border-2 border-dashed border-gray-300",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(m.FileText,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"file"===e?`Document: ${t.fileName}`:`Report: ${t.eventName}`}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Live document preview would appear here"}),(0,s.jsxs)(r.Button,{variant:"outline",size:"sm",className:"mt-4",onClick:i,children:[(0,s.jsx)(n.Download,{className:"h-4 w-4 mr-2"}),"Download Document"]})]})})})]})}function u({type:e,item:t}){return(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{children:(0,s.jsx)(a.CardTitle,{children:"Document Details"})}),(0,s.jsx)(a.CardContent,{children:"file"===e?(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"File Type"}),(0,s.jsx)("p",{children:t.fileType})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Upload Date"}),(0,s.jsx)("p",{children:t.uploadDate})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Course Name"}),(0,s.jsx)("p",{children:t.courseName})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Semester"}),(0,s.jsx)("p",{children:t.semester})]})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Event Type"}),(0,s.jsx)("p",{children:t.eventType})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Event Date"}),(0,s.jsx)("p",{children:t.eventDate})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Location"}),(0,s.jsx)("p",{children:t.location})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Participants"}),(0,s.jsx)("p",{children:t.participants})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Description"}),(0,s.jsx)("p",{className:"text-sm",children:t.description})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Objectives"}),(0,s.jsx)("p",{className:"text-sm",children:t.objectives})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Outcomes & Impact"}),(0,s.jsx)("p",{className:"text-sm",children:t.outcomes})]})]})})]})}var j=e.i(24687),p=e.i(75254);let g=(0,p.default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),v=(0,p.default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function f({type:e,auditorRemarks:t,onRemarksChange:i,reviewDecision:l,onDecisionChange:n,onSubmit:c,checklist:o,checkedItems:m}){return(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{children:(0,s.jsx)(a.CardTitle,{children:"Auditor Remarks"})}),(0,s.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,s.jsx)(j.Textarea,{placeholder:"Provide detailed feedback and remarks...",value:t,onChange:e=>i(e.target.value),rows:6}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)(r.Button,{variant:"approve"===l?"default":"outline",onClick:()=>n("approve"),className:"flex-1",children:[(0,s.jsx)(g,{className:"h-4 w-4 mr-2"}),"Approve"]}),(0,s.jsxs)(r.Button,{variant:"reject"===l?"destructive":"outline",onClick:()=>n("reject"),className:"flex-1",children:[(0,s.jsx)(v,{className:"h-4 w-4 mr-2"}),"Reject"]})]}),(0,s.jsx)(r.Button,{onClick:()=>{l?o.every(e=>m[e.id])?t.trim()?c():d.toast.error("Please provide auditor remarks"):d.toast.error("Please complete all checklist items"):d.toast.error("Please select approve or reject")},className:"w-full",size:"lg",children:"Submit Review"})]})]})}var N=e.i(32341),y=e.i(43682);let w=[{id:"format",label:"Document format is correct and readable"}],b=[{id:"details",label:"Event details are complete and accurate"}];function C({type:e,item:c,facultyName:m,facultyId:x,onBack:j,onReviewCompleted:p}){let[g,v]=(0,t.useState)({}),[C,R]=(0,t.useState)(""),[T,k]=(0,t.useState)(null),{user:A}=(0,N.useAuth)(),S="file"===e?w:b,D=async()=>{if(!T)return void d.toast.error("Please select approve or reject");let s="approve"===T?"Approved":"Rejected",t=new Date().toISOString().split("T")[0],a=A?.name??"Auditor";try{let r=await fetch("file"===e?`/api/course-files/${c.id}`:`/api/event-reports/${c.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s,adminRemarks:C,reviewedBy:a,reviewedDate:t})}),i=await r.json();if(!r.ok)return void d.toast.error(i.error||"Review update failed");let l=("file"===e?i.files:i.reports).filter(e=>e.id===c.id).reduce((e,s)=>e??s,void 0);if(l&&p?.(l),await fetch("/api/audits",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auditorId:A?.id,entityType:"file"===e?"course-file":"event-report",entityId:c.id,status:"approve"===T?"completed":"rejected",remarks:C})}),await fetch("/api/remarks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({authorId:A?.id,entityType:"file"===e?"course-file":"event-report",entityId:c.id,status:"published",text:C})}),x){let t=`${"file"===e?"course-file":"event-report"}:${c.id}`;await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({facultyId:x,auditorId:A?.id,entityType:"file"===e?"course-file":"event-report",entityId:c.id,threadId:t,senderRole:"auditor",senderName:A?.name,message:C||`${"file"===e?"Course file":"Event report"} ${s.toLowerCase()}.`,status:s.toLowerCase()})})}d.toast.success(`${"file"===e?"Course file":"Event report"} ${T}d successfully`),window.dispatchEvent(new Event("dashboard:data-updated")),j()}catch(e){console.error("Review submit error:",e),d.toast.error("Failed to submit review")}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(r.Button,{variant:"outline",onClick:j,children:[(0,s.jsx)(l.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to Faculty List"]}),(0,s.jsxs)(r.Button,{variant:"outline",onClick:()=>{let s="Checklist Item,Status\n";S.forEach(e=>{let t=g[e.id]||"pending";s+=`"${e.label}",${t}
`});let t=new Blob([s+=`
Remarks,"${C}"
Decision,${T||"pending"}
`],{type:"text/csv"}),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a;let i="file"===e?c.fileName:c.eventName?.replace(/ /g,"_")||"report";r.download=`audit-${m.replace(/ /g,"_")}-${i}.csv`,r.click(),window.URL.revokeObjectURL(a),d.toast.success("Audit sheet downloaded successfully")},children:[(0,s.jsx)(n.Download,{className:"h-4 w-4 mr-2"}),"Download Audit Sheet"]})]}),(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:m}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"file"===e?"Course File Review":"Event Report Review"})]}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsx)(i.Badge,{className:"approve"===T?"bg-green-100 text-green-800":"",variant:"approve"===T?"default":"outline",children:"approve"===T?"Approved":"Not Approved"})})]})})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,s.jsx)(o,{checklist:S,checkedItems:g,onChecklistChange:(e,s)=>{v({...g,[e]:s})}}),(0,s.jsxs)("div",{className:"lg:col-span-3 space-y-6",children:[(0,s.jsx)(h,{type:e,item:c,onDownload:()=>{if("file"===e){let e=(0,y.sanitizeFileName)(c.fileName,"course-file");if(c.documentUrl){(0,y.downloadFromDataUrl)(c.documentUrl,e),d.toast.success(`Downloading ${c.fileName}`);return}let s=e.replace(/\.[^/.]+$/,""),t=`${s||"course-file"}-summary.txt`,a=`File Name: ${c.fileName}
Document data is not available in storage.`;(0,y.downloadTextFile)(a,t),d.toast.success(`Downloaded summary for ${c.fileName}`);return}let s=(0,y.sanitizeFileName)(c.eventName,"event-report"),t=`${s||"event-report"}.json`;(0,y.downloadJsonFile)(c,t),d.toast.success(`Downloading ${c.eventName}`)}}),(0,s.jsx)(u,{type:e,item:c}),(0,s.jsx)(f,{type:e,item:c,auditorRemarks:C,onRemarksChange:R,reviewDecision:T,onDecisionChange:k,onSubmit:D,checklist:S,checkedItems:g})]})]})]})}function R({onBack:e}){return(0,s.jsxs)(r.Button,{variant:"outline",onClick:e,children:[(0,s.jsx)(l.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to Faculty List"]})}function T({faculty:e}){return(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"h-16 w-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-2xl font-semibold",children:e.name.split(" ").map(e=>e[0]).join("")}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:e.name}),(0,s.jsx)("p",{className:"text-gray-600",children:e.department}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mt-2",children:[(0,s.jsxs)(i.Badge,{variant:"outline",children:[e.totalFiles," Course Files"]}),(0,s.jsxs)(i.Badge,{variant:"outline",children:[e.totalReports," Event Reports"]})]})]})]})})}var k=e.i(77572),A=e.i(98919);function S({file:e,onReview:t,getStatusColor:l}){return(0,s.jsx)(a.Card,{className:"hover:shadow-lg transition-shadow",children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 flex-1",children:[(0,s.jsx)("div",{className:"h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,s.jsx)(m.FileText,{className:"h-5 w-5 text-blue-600"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium truncate",children:e.fileName}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.courseName})]})]}),(0,s.jsx)(i.Badge,{className:l(e.status),children:e.status})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Badge,{variant:"outline",children:e.fileType}),(0,s.jsx)("span",{className:"text-gray-500 ml-2",children:e.semester})]}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:e.uploadDate})]}),e.auditorRemarks&&(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-green-800 mb-1",children:"Auditor Remarks:"}),(0,s.jsx)("p",{className:"text-sm text-green-700",children:e.auditorRemarks})]}),(0,s.jsxs)(r.Button,{variant:"Submitted"===e.status?"default":"outline",size:"sm",onClick:()=>t(e),className:"w-full",children:[(0,s.jsx)(A.Shield,{className:"h-4 w-4 mr-2"}),"Submitted"===e.status?"Review & Audit":"View Review"]})]})})})}function D({report:e,onReview:t,getStatusColor:l}){return(0,s.jsx)(a.Card,{className:"hover:shadow-lg transition-shadow",children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 flex-1",children:[(0,s.jsx)("div",{className:"h-10 w-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,s.jsx)(x.Calendar,{className:"h-5 w-5 text-green-600"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium line-clamp-1",children:e.eventName}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.location})]})]}),(0,s.jsx)(i.Badge,{className:l(e.status),children:e.status})]}),(0,s.jsx)("div",{className:"flex items-center justify-between text-sm",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.Badge,{variant:"outline",children:e.eventType}),(0,s.jsxs)("span",{className:"text-gray-500",children:[e.participants," participants"]})]})}),e.auditorRemarks&&(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-green-800 mb-1",children:"Auditor Remarks:"}),(0,s.jsx)("p",{className:"text-sm text-green-700",children:e.auditorRemarks})]}),(0,s.jsxs)(r.Button,{variant:"Submitted"===e.status?"default":"outline",size:"sm",onClick:()=>t(e),className:"w-full",children:[(0,s.jsx)(A.Shield,{className:"h-4 w-4 mr-2"}),"Submitted"===e.status?"Review & Audit":"View Review"]})]})})})}function F({courseFiles:e,eventReports:t,onReviewFile:a,onReviewReport:r,getStatusColor:i}){return(0,s.jsxs)(k.Tabs,{defaultValue:"course-files",children:[(0,s.jsxs)(k.TabsList,{className:"grid w-full grid-cols-2",children:[(0,s.jsxs)(k.TabsTrigger,{value:"course-files",children:[(0,s.jsx)(m.FileText,{className:"h-4 w-4 mr-2"}),"Course Files"]}),(0,s.jsxs)(k.TabsTrigger,{value:"event-reports",children:[(0,s.jsx)(x.Calendar,{className:"h-4 w-4 mr-2"}),"Event Reports"]})]}),(0,s.jsx)(k.TabsContent,{value:"course-files",className:"space-y-4 mt-6",children:(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.map(e=>(0,s.jsx)(S,{file:e,onReview:a,getStatusColor:i},e.id))})}),(0,s.jsx)(k.TabsContent,{value:"event-reports",className:"space-y-4 mt-6",children:(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map(e=>(0,s.jsx)(D,{report:e,onReview:r,getStatusColor:i},e.id))})})]})}var B=e.i(72871);function I({faculty:e,onBack:l}){let{user:n}=(0,N.useAuth)(),[d,c]=(0,t.useState)(!1),[o,m]=(0,t.useState)(null),[x,h]=(0,t.useState)(null),[u,j]=(0,t.useState)(null),[p,g]=(0,t.useState)(!1),[v,f]=(0,t.useState)("file"),[y,w]=(0,t.useState)([]),[b,k]=(0,t.useState)([]),[A,S]=(0,t.useState)([]),D=Object.entries(A.reduce((e,s)=>{let t=s.threadId??`${s.entityType}:${s.entityId}`;return e[t]||(e[t]=[]),e[t].push({...s,threadId:t}),e},{})).map(([e,s])=>{let t=[...s].sort((e,s)=>{let t=new Date(e.createdAt??0).getTime();return new Date(s.createdAt??0).getTime()-t}),a=t[t.length-1];return{threadId:e,messages:t,lastMessage:a}}).sort((e,s)=>{let t=new Date(e.lastMessage?.createdAt??0).getTime();return new Date(s.lastMessage?.createdAt??0).getTime()-t}),I=y.reduce((e,s)=>(e[s.id]=s.fileName,e),{}),E=b.reduce((e,s)=>(e[s.id]=s.eventName,e),{}),O=D.reduce((e,s)=>{if(s.lastMessage?.entityType!=="course-file")return e;let t=s.lastMessage.entityId,a=I[t]??"Course File";return e[t]||(e[t]={fileId:t,fileName:a,threads:[]}),e[t].threads.push(s),e},{});Object.values(O).forEach(e=>{e.threads.sort((e,s)=>{let t=new Date(e.lastMessage?.createdAt??0).getTime();return new Date(s.lastMessage?.createdAt??0).getTime()-t})});let $=D.reduce((e,s)=>{if(s.lastMessage?.entityType!=="event-report")return e;let t=s.lastMessage.entityId,a=E[t]??"Event Report";return e[t]||(e[t]={reportId:t,reportName:a,threads:[]}),e[t].threads.push(s),e},{});Object.values($).forEach(e=>{e.threads.sort((e,s)=>{let t=new Date(e.lastMessage?.createdAt??0).getTime();return new Date(s.lastMessage?.createdAt??0).getTime()-t})});let M=Object.values(O).sort((e,s)=>{let t=e.threads[0]?.lastMessage?.createdAt??0;return new Date(s.threads[0]?.lastMessage?.createdAt??0).getTime()-new Date(t).getTime()}),L=Object.values($).sort((e,s)=>{let t=e.threads[0]?.lastMessage?.createdAt??0;return new Date(s.threads[0]?.lastMessage?.createdAt??0).getTime()-new Date(t).getTime()});(0,t.useEffect)(()=>{let s=async()=>{try{let[s,t,a]=await Promise.all([fetch("/api/course-files"),fetch("/api/event-reports"),fetch(`/api/messages?facultyId=${e.id}`)]),r=await s.json(),i=await t.json(),l=await a.json();if(!s.ok||!t.ok||!a.ok)return;let n=(r.files??[]).filter(s=>s.facultyId===e.id),d=(i.reports??[]).filter(s=>s.facultyId===e.id);w(n),k(d),S(l.messages??[])}catch(e){console.error("Load faculty portfolio error:",e)}};s();{let e=()=>{s()};return window.addEventListener("dashboard:data-updated",e),()=>{window.removeEventListener("dashboard:data-updated",e)}}},[e.id]);let P=D.find(e=>e.threadId===o)??null,z=async s=>{if(!n?.id||!P)return;let t=P.messages[0];await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({facultyId:e.id,auditorId:n.id,entityType:t.entityType,entityId:t.entityId,threadId:P.threadId,senderRole:"auditor",senderName:n.name,message:s})}),window.dispatchEvent(new Event("dashboard:data-updated"))},U=async e=>{await fetch(`/api/messages?threadId=${e}`,{method:"DELETE"}),window.dispatchEvent(new Event("dashboard:data-updated"))};return p&&(x||u)?(0,s.jsx)(C,{type:v,item:"file"===v?x:u,facultyName:e.name,facultyId:e.id,onBack:()=>g(!1),onReviewCompleted:e=>{"file"===v?(w(s=>s.map(s=>s.id===e.id?e:s)),h(e)):(k(s=>s.map(s=>s.id===e.id?e:s)),j(e))}}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(R,{onBack:l}),(0,s.jsx)(T,{faculty:e}),(0,s.jsx)(a.Card,{children:(0,s.jsxs)(a.CardContent,{className:"pt-6 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Auditor Messages"}),(0,s.jsx)(i.Badge,{variant:"outline",children:D.length})]}),0===M.length&&0===L.length?(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"No messages yet."}):(0,s.jsxs)("div",{className:"space-y-3",children:[M.map(e=>(0,s.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.fileName}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Course File"})]}),(0,s.jsx)(i.Badge,{variant:"outline",children:e.threads.reduce((e,s)=>e+s.messages.length,0)})]}),(0,s.jsx)("div",{className:"mt-3 space-y-3",children:e.threads.map(e=>(0,s.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Thread"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.lastMessage?.status&&(0,s.jsx)(i.Badge,{variant:"secondary",children:e.lastMessage.status}),(0,s.jsx)(r.Button,{variant:"outline",size:"sm",onClick:()=>{m(e.threadId),c(!0)},children:"Reply"}),(0,s.jsx)(r.Button,{size:"sm",onClick:()=>U(e.threadId),children:"OK"})]})]}),(0,s.jsx)("div",{className:"mt-3 space-y-2",children:e.messages.map(e=>(0,s.jsxs)("div",{className:"rounded-md bg-white p-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,s.jsx)("span",{children:e.senderName||e.senderRole||"Message"}),e.createdAt&&(0,s.jsx)("span",{children:new Date(e.createdAt).toLocaleString()})]}),(0,s.jsx)("p",{className:"text-sm text-gray-700 mt-1",children:e.message})]},e.id))})]},e.threadId))})]},e.fileId)),L.map(e=>(0,s.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.reportName}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Event Report"})]}),(0,s.jsx)(i.Badge,{variant:"outline",children:e.threads.reduce((e,s)=>e+s.messages.length,0)})]}),(0,s.jsx)("div",{className:"mt-3 space-y-3",children:e.threads.map(e=>(0,s.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Thread"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.lastMessage?.status&&(0,s.jsx)(i.Badge,{variant:"secondary",children:e.lastMessage.status}),(0,s.jsx)(r.Button,{variant:"outline",size:"sm",onClick:()=>{m(e.threadId),c(!0)},children:"Reply"}),(0,s.jsx)(r.Button,{size:"sm",onClick:()=>U(e.threadId),children:"OK"})]})]}),(0,s.jsx)("div",{className:"mt-3 space-y-2",children:e.messages.map(e=>(0,s.jsxs)("div",{className:"rounded-md bg-white p-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,s.jsx)("span",{children:e.senderName||e.senderRole||"Message"}),e.createdAt&&(0,s.jsx)("span",{children:new Date(e.createdAt).toLocaleString()})]}),(0,s.jsx)("p",{className:"text-sm text-gray-700 mt-1",children:e.message})]},e.id))})]},e.threadId))})]},e.reportId))]})]})}),(0,s.jsx)(F,{courseFiles:y,eventReports:b,onReviewFile:e=>{h(e),f("file"),g(!0)},onReviewReport:e=>{j(e),f("report"),g(!0)},getStatusColor:e=>{switch(e){case"Approved":return"bg-green-100 text-green-800";case"Pending":return"bg-yellow-100 text-yellow-800";case"Submitted":return"bg-blue-100 text-blue-800";case"Draft":default:return"bg-gray-100 text-gray-800";case"Rejected":return"bg-red-100 text-red-800"}}}),(0,s.jsx)(B.ResponseDialog,{open:d,onOpenChange:c,onSubmit:z,itemType:P?.lastMessage?.entityType==="course-file"?"file":"report"})]})}function E(){return(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"h-12 w-12 bg-orange-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)(A.Shield,{className:"h-6 w-6 text-orange-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{children:"Auditor Dashboard"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Quality Assurance & Compliance Review"})]})]})}var O=e.i(61911),$=e.i(63209);function M({stats:e}){return(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Total Faculty"}),(0,s.jsx)("div",{className:"text-2xl mt-1",children:e.totalFaculty})]}),(0,s.jsx)("div",{className:"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)(O.Users,{className:"h-6 w-6 text-blue-600"})})]})})}),(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Total Course Files"}),(0,s.jsx)("div",{className:"text-2xl mt-1",children:e.totalFiles}),(0,s.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:[e.approvedFiles," approved"]})]}),(0,s.jsx)("div",{className:"h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)(m.FileText,{className:"h-6 w-6 text-green-600"})})]})})}),(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Total Event Reports"}),(0,s.jsx)("div",{className:"text-2xl mt-1",children:e.totalReports}),(0,s.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:[e.approvedReports," approved"]})]}),(0,s.jsx)("div",{className:"h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)(x.Calendar,{className:"h-6 w-6 text-purple-600"})})]})})}),(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Pending Reviews"}),(0,s.jsx)("div",{className:"text-2xl mt-1",children:e.pendingFiles+e.pendingReports}),(0,s.jsx)("p",{className:"text-xs text-orange-600 mt-1",children:"Requires attention"})]}),(0,s.jsx)("div",{className:"h-12 w-12 bg-orange-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)($.AlertCircle,{className:"h-6 w-6 text-orange-600"})})]})})})]})}var L=e.i(29592);function P({stats:e}){let t=e.pendingFiles+e.pendingReports;return 0===t?null:(0,s.jsxs)(L.Alert,{className:"bg-orange-50 border-orange-200",children:[(0,s.jsx)($.AlertCircle,{className:"h-4 w-4 text-orange-600"}),(0,s.jsxs)(L.AlertDescription,{children:["You have ",t," pending items awaiting review and approval."]})]})}function z({stats:e}){let t=e.approvedFiles+e.rejectedFiles,r=e.approvedReports+e.rejectedReports,i=t>0?Math.round(e.approvedFiles/t*100):0,l=r>0?Math.round(e.approvedReports/r*100):0;return(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsx)(a.CardTitle,{children:"Review Statistics"}),(0,s.jsx)(a.CardDescription,{children:"Overall submission quality metrics"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm",children:"Course Files Approved"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:[i,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${i}%`}})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600 mt-2",children:[(0,s.jsxs)("span",{children:["Approved: ",e.approvedFiles]}),(0,s.jsxs)("span",{children:["Rejected: ",e.rejectedFiles]}),(0,s.jsxs)("span",{children:["Pending: ",e.pendingFiles]}),(0,s.jsxs)("span",{children:["Total: ",e.totalFiles]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm",children:"Event Reports Approved"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:[l,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${l}%`}})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600 mt-2",children:[(0,s.jsxs)("span",{children:["Approved: ",e.approvedReports]}),(0,s.jsxs)("span",{children:["Rejected: ",e.rejectedReports]}),(0,s.jsxs)("span",{children:["Pending: ",e.pendingReports]}),(0,s.jsxs)("span",{children:["Total: ",e.totalReports]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm",children:"Overall Completion Rate"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:[e.completionRate,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${e.completionRate}%`}})})]})]})})]})}function U({reviews:e}){return(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsx)(a.CardTitle,{children:"Recent Review Activity"}),(0,s.jsx)(a.CardDescription,{children:"Your latest review actions"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)("div",{className:"space-y-4",children:e.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start gap-3 pb-3 border-b last:border-0",children:[(0,s.jsx)("div",{className:"h-2 w-2 rounded-full bg-orange-600 mt-2"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"font-medium",children:e.action})," ",e.item]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e.faculty," â€¢ ",e.time]})]})]},t))})})]})}let H=(0,p.default)("clipboard-check",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);var J=e.i(86536),V=e.i(63059);function q({faculty:e}){return(0,s.jsxs)("div",{className:"flex items-center gap-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Course Files"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(i.Badge,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[(0,s.jsx)(g,{className:"h-3 w-3 mr-1"}),e.approvedFiles]}),e.pendingFiles>0&&(0,s.jsxs)(i.Badge,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:[(0,s.jsx)($.AlertCircle,{className:"h-3 w-3 mr-1"}),e.pendingFiles]})]})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Event Reports"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(i.Badge,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[(0,s.jsx)(g,{className:"h-3 w-3 mr-1"}),e.approvedReports]}),e.pendingReports>0&&(0,s.jsxs)(i.Badge,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:[(0,s.jsx)($.AlertCircle,{className:"h-3 w-3 mr-1"}),e.pendingReports]})]})]})]})}function K({faculty:e,onClick:t}){return(0,s.jsx)(a.Card,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>t(e),children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,s.jsx)("div",{className:"h-12 w-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white flex-shrink-0",children:e.name.split(" ").map(e=>e[0]).join("")}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium",children:e.name}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.department})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-6",children:[(0,s.jsx)(q,{faculty:e}),(0,s.jsxs)(r.Button,{variant:"outline",size:"sm",children:[(0,s.jsx)(J.Eye,{className:"h-4 w-4 mr-2"}),"Review",(0,s.jsx)(V.ChevronRight,{className:"h-4 w-4 ml-2"})]})]})]})})})}function Y({facultyMembers:e,onSelectFaculty:t}){return(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(H,{className:"h-5 w-5"}),"Faculty Submission Status"]}),(0,s.jsx)(a.CardDescription,{children:"Review and audit faculty course files and event reports"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)("div",{className:"space-y-3",children:e.map(e=>(0,s.jsx)(K,{faculty:e,onClick:t},e.id))})})]})}function _({stats:e,facultyMembers:a,recentReviews:r}){let[i,l]=(0,t.useState)(null),[n,d]=(0,t.useState)(e),[c,o]=(0,t.useState)(a),[m,x]=(0,t.useState)(r);return((0,t.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/dashboard/auditor"),s=await e.json();if(!e.ok)return;s?.stats&&d(s.stats),s?.facultyMembers&&o(s.facultyMembers),s?.recentReviews&&x(s.recentReviews)}catch(e){console.error("Auditor dashboard refresh error:",e)}};e();{let s=()=>{e()};return window.addEventListener("dashboard:data-updated",s),()=>{window.removeEventListener("dashboard:data-updated",s)}}},[]),i)?(0,s.jsx)(I,{faculty:i,onBack:()=>l(null)}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(E,{}),(0,s.jsx)(M,{stats:n}),(0,s.jsx)(P,{stats:n}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsx)(z,{stats:n}),(0,s.jsx)(U,{reviews:m})]}),(0,s.jsx)(Y,{facultyMembers:c,onSelectFaculty:l})]})}e.s(["AuditorDashboard",()=>_],68349)}]);