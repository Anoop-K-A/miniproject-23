(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,3166,e=>{"use strict";var s=e.i(43476),a=e.i(71645),l=e.i(15288),t=e.i(19455),r=e.i(93479),i=e.i(10204),n=e.i(67489),c=e.i(84774),d=e.i(76639),o=e.i(69074),m=e.i(78583),x=e.i(40160),u=e.i(27612),h=e.i(55436),j=e.i(87130),p=e.i(86311),f=e.i(86536),g=e.i(29006),v=e.i(61911),y=e.i(87486),N=e.i(46696),w=e.i(29592),b=e.i(72871),S=e.i(77572),C=e.i(70568),T=e.i(71689);function D({file:e,onBack:a,onDownload:l}){return(0,s.jsx)("div",{className:"bg-white border-b sticky top-0 z-10",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)(t.Button,{variant:"outline",onClick:a,children:[(0,s.jsx)(T.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to Files"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-semibold",children:e.fileName}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[e.courseCode," - ",e.courseName]})]})]}),(0,s.jsxs)(t.Button,{onClick:()=>l(e),children:[(0,s.jsx)(x.Download,{className:"h-4 w-4 mr-2"}),"Download"]})]})})})}function R({file:e}){return(0,s.jsxs)(l.Card,{className:"border-0 shadow-sm",children:[(0,s.jsx)("div",{className:"aspect-video bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg flex items-center justify-center border-2 border-dashed border-gray-300",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(m.FileText,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Document Preview"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["File: ",e.fileName]})]})}),(0,s.jsxs)("div",{className:"p-4 space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"File Type:"}),(0,s.jsx)("span",{className:"text-sm text-gray-900",children:".pdf"})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Upload Date:"}),(0,s.jsx)("span",{className:"text-sm text-gray-900",children:e.uploadDate})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),(0,s.jsx)(y.Badge,{variant:"Approved"===e.status?"default":"Pending"===e.status?"secondary":"outline",children:e.status})]})]})]})}var F=e.i(84614),A=e.i(10980),$=e.i(87316);function k({file:e}){return(0,s.jsxs)(l.Card,{className:"p-4 space-y-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:"File Information"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(F.User,{className:"h-4 w-4 text-gray-400 mt-1 flex-shrink-0"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Faculty"}),(0,s.jsx)("p",{className:"text-sm text-gray-900",children:e.facultyName})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(A.BookOpen,{className:"h-4 w-4 text-gray-400 mt-1 flex-shrink-0"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Department"}),(0,s.jsx)("p",{className:"text-sm text-gray-900",children:e.department})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(A.BookOpen,{className:"h-4 w-4 text-gray-400 mt-1 flex-shrink-0"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Course"}),(0,s.jsx)("p",{className:"text-sm text-gray-900",children:e.courseName}),(0,s.jsx)("p",{className:"text-xs text-gray-600",children:e.courseCode})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)($.Calendar,{className:"h-4 w-4 text-gray-400 mt-1 flex-shrink-0"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Semester"}),(0,s.jsx)("p",{className:"text-sm text-gray-900",children:e.semester})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)($.Calendar,{className:"h-4 w-4 text-gray-400 mt-1 flex-shrink-0"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Upload Date"}),(0,s.jsx)("p",{className:"text-sm text-gray-900",children:e.uploadDate})]})]}),e.status&&(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"h-4 w-4 mt-1 flex-shrink-0"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Status"}),(0,s.jsx)(y.Badge,{variant:"Approved"===e.status?"default":"Pending"===e.status?"secondary":"outline",children:e.status})]})]})]})]})}let I=(0,e.i(75254).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var B=e.i(63209);function U({file:e}){return e.adminRemarks?(0,s.jsx)(w.Alert,{className:"Approved"===e.status?"border-green-200 bg-green-50":"border-yellow-200 bg-yellow-50",children:(0,s.jsxs)("div",{className:"flex gap-3",children:["Approved"===e.status?(0,s.jsx)(I,{className:"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0"}):(0,s.jsx)(B.AlertCircle,{className:"h-4 w-4 text-yellow-600 mt-0.5 flex-shrink-0"}),(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-900",children:"Admin Review"}),(0,s.jsx)(y.Badge,{variant:"Approved"===e.status?"default":"secondary",children:e.status})]}),(0,s.jsx)(w.AlertDescription,{className:"text-gray-700 text-sm",children:e.adminRemarks}),e.reviewedBy&&e.reviewedDate&&(0,s.jsxs)("p",{className:"text-xs text-gray-600 mt-2",children:["Reviewed by ",e.reviewedBy," on ",e.reviewedDate]})]})]})}):null}var L=e.i(30030),P=e.i(30207),Y=e.i(34620),O=e.i(48425),z="Avatar",[H,E]=(0,L.createContextScope)(z),[V,M]=H(z),q=a.forwardRef((e,l)=>{let{__scopeAvatar:t,...r}=e,[i,n]=a.useState("idle");return(0,s.jsx)(V,{scope:t,imageLoadingStatus:i,onImageLoadingStatusChange:n,children:(0,s.jsx)(O.Primitive.span,{...r,ref:l})})});q.displayName=z;var J="AvatarImage",K=a.forwardRef((e,l)=>{let{__scopeAvatar:t,src:r,onLoadingStatusChange:i=()=>{},...n}=e,c=M(J,t),d=function(e,s){let[l,t]=a.useState("idle");return(0,Y.useLayoutEffect)(()=>{if(!e)return void t("error");let a=!0,l=new window.Image,r=e=>()=>{a&&t(e)};return t("loading"),l.onload=r("loaded"),l.onerror=r("error"),l.src=e,s&&(l.referrerPolicy=s),()=>{a=!1}},[e,s]),l}(r,n.referrerPolicy),o=(0,P.useCallbackRef)(e=>{i(e),c.onImageLoadingStatusChange(e)});return(0,Y.useLayoutEffect)(()=>{"idle"!==d&&o(d)},[d,o]),"loaded"===d?(0,s.jsx)(O.Primitive.img,{...n,ref:l,src:r}):null});K.displayName=J;var G="AvatarFallback",Q=a.forwardRef((e,l)=>{let{__scopeAvatar:t,delayMs:r,...i}=e,n=M(G,t),[c,d]=a.useState(void 0===r);return a.useEffect(()=>{if(void 0!==r){let e=window.setTimeout(()=>d(!0),r);return()=>window.clearTimeout(e)}},[r]),c&&"loaded"!==n.imageLoadingStatus?(0,s.jsx)(O.Primitive.span,{...i,ref:l}):null});Q.displayName=G;var W=e.i(19204);function X({className:e,...a}){return(0,s.jsx)(q,{"data-slot":"avatar",className:(0,W.cn)("relative flex size-10 shrink-0 overflow-hidden rounded-full",e),...a})}function Z({className:e,...a}){return(0,s.jsx)(K,{"data-slot":"avatar-image",className:(0,W.cn)("aspect-square size-full",e),...a})}function _({className:e,...a}){return(0,s.jsx)(Q,{"data-slot":"avatar-fallback",className:(0,W.cn)("bg-muted flex size-full items-center justify-center rounded-full",e),...a})}var ee=e.i(73443),es=e.i(7233);function ea({reviews:e,selectedReview:a,onSelectReview:r,onAddReview:i}){return(0,s.jsxs)(l.Card,{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:"Peer Reviews"}),(0,s.jsxs)(t.Button,{size:"sm",variant:"outline",onClick:i,className:"gap-2",children:[(0,s.jsx)(es.Plus,{className:"h-4 w-4"}),"Add Review"]})]}),0===e.length?(0,s.jsx)("p",{className:"text-sm text-gray-600 text-center py-4",children:"No peer reviews yet. Be the first to review!"}):(0,s.jsx)(ee.Accordion,{type:"single",collapsible:!0,className:"w-full",children:e.map(e=>(0,s.jsxs)(ee.AccordionItem,{value:e.id,className:"border-b",children:[(0,s.jsx)(ee.AccordionTrigger,{className:"hover:no-underline py-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-3 w-full",children:[(0,s.jsxs)(X,{className:"h-8 w-8",children:[(0,s.jsx)(Z,{src:e.reviewerAvatar}),(0,s.jsx)(_,{children:e.reviewerName.split(" ").map(e=>e[0]).join("")})]}),(0,s.jsxs)("div",{className:"text-left flex-1",children:[(0,s.jsx)("p",{className:"font-medium text-sm text-gray-900",children:e.reviewerName}),(0,s.jsx)("p",{className:"text-xs text-gray-600",children:e.reviewDate})]}),(0,s.jsx)(p.MessageSquare,{className:"h-4 w-4 text-gray-400"})]})}),(0,s.jsxs)(ee.AccordionContent,{className:"pt-4 space-y-3",children:[(0,s.jsx)("p",{className:"text-sm text-gray-700",children:e.comment}),e.facultyResponse&&(0,s.jsxs)("div",{className:"bg-blue-50 border-l-4 border-blue-200 p-3 rounded",children:[(0,s.jsx)("p",{className:"text-xs font-semibold text-blue-900 mb-1",children:"Faculty Response"}),(0,s.jsx)("p",{className:"text-sm text-blue-700",children:e.facultyResponse})]})]})]},e.id))})]})}var el=e.i(43682);function et({file:e,onBack:l}){let[t,r]=(0,a.useState)(!1),[i,n]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null),[o,m]=(0,a.useState)(e.peerReviews||[]);return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(D,{file:e,onBack:l,onDownload:e=>{let s=(0,el.sanitizeFileName)(e.fileName,"course-file");if(e.documentUrl)return void(0,el.downloadFromDataUrl)(e.documentUrl,s);let a=s.replace(/\.[^/.]+$/,""),l=`${a||"course-file"}-summary.txt`,t=`File Name: ${e.fileName}
Course: ${e.courseCode} - ${e.courseName}
Type: ${e.fileType}
Semester: ${e.semester}
Academic Year: ${e.academicYear}
Uploaded: ${e.uploadDate}
Faculty: ${e.facultyName}
Department: ${e.department}
Status: ${e.status??"Unknown"}`;(0,el.downloadTextFile)(t,l)}}),(0,s.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"col-span-2 space-y-6",children:[(0,s.jsx)(R,{file:e}),(0,s.jsx)(U,{file:e}),(0,s.jsx)(ea,{reviews:o,selectedReview:c,onSelectReview:d,onAddReview:()=>r(!0)})]}),(0,s.jsx)("div",{children:(0,s.jsx)(k,{file:e})})]})}),t&&(0,s.jsx)(C.PeerReviewDialog,{open:t,onOpenChange:r,onSubmit:e=>{m([...o,{id:Date.now().toString(),reviewerName:"Current User",comment:e,reviewDate:new Date().toLocaleDateString(),facultyResponse:void 0,reviewerAvatar:`https://api.dicebear.com/7.x/avataaars/svg?seed=${Math.random()}`}]),r(!1)},itemType:"file",itemName:e.fileName}),c&&i&&(0,s.jsx)(b.ResponseDialog,{open:i,onOpenChange:n,onSubmit:e=>{c&&(m(o.map(s=>s.id===c.id?{...s,facultyResponse:e}:s)),d(null),n(!1))},itemType:"file"})]})}function er({files:e,currentUser:i,onFilesChange:d}){let[o,u]=(0,a.useState)(""),[g,v]=(0,a.useState)("all"),[w,S]=(0,a.useState)("all"),[T,D]=(0,a.useState)("all"),[R,F]=(0,a.useState)(!1),[A,$]=(0,a.useState)(null),[k,I]=(0,a.useState)(!1),[B,U]=(0,a.useState)(!1),[L,P]=(0,a.useState)(null),Y=e=>{let s=(0,el.sanitizeFileName)(e.fileName,"course-file");if(e.documentUrl){(0,el.downloadFromDataUrl)(e.documentUrl,s),N.toast.success(`Downloading ${e.fileName}`);return}let a=s.replace(/\.[^/.]+$/,""),l=`${a||"course-file"}-summary.txt`,t=`File Name: ${e.fileName}
Course: ${e.courseCode} - ${e.courseName}
Type: ${e.fileType}
Semester: ${e.semester}
Academic Year: ${e.academicYear}
Uploaded: ${e.uploadDate}
Faculty: ${e.facultyName}
Department: ${e.department}
Status: ${e.status??"Unknown"}`;(0,el.downloadTextFile)(t,l),N.toast.success(`Downloaded summary for ${e.fileName}`)},O=async e=>{if(!A)return;let s={id:`pr${Date.now()}`,reviewerName:i,reviewDate:new Date().toISOString().split("T")[0],comment:e},a={...A,peerReviews:[...A.peerReviews||[],s]};try{let e=await fetch(`/api/course-files/${A.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({peerReviews:a.peerReviews})}),s=await e.json();if(!e.ok)return void N.toast.error(s.error||"Peer review failed");d?.(s.files);let l=s.files.filter(e=>e.id===A.id).reduce((e,s)=>e??s,void 0);$(l??a),I(!1)}catch(e){console.error("Peer review error:",e),N.toast.error("An error occurred while submitting review")}},z=async e=>{if(!A||!L)return;let s={...A,peerReviews:A.peerReviews?.map(s=>s.id===L.id?{...s,facultyResponse:e,responseDate:new Date().toISOString().split("T")[0]}:s)};try{let e=await fetch(`/api/course-files/${A.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({peerReviews:s.peerReviews})}),a=await e.json();if(!e.ok)return void N.toast.error(a.error||"Response failed");d?.(a.files);let l=a.files.filter(e=>e.id===A.id).reduce((e,s)=>e??s,void 0);$(l??s),P(null),U(!1)}catch(e){console.error("Response error:",e),N.toast.error("An error occurred while responding")}},H=e.filter(e=>{let s=e.fileName.toLowerCase().includes(o.toLowerCase())||e.courseCode.toLowerCase().includes(o.toLowerCase())||e.facultyName.toLowerCase().includes(o.toLowerCase()),a="all"===g||e.department===g,l="all"===w||e.status===w,t="all"===T||e.academicYear===T;return s&&a&&l&&t}),E=Array.from(new Set(e.map(e=>e.department))),V=Array.from(new Set(e.map(e=>e.academicYear)));return R&&A?(0,s.jsx)(et,{file:A,onBack:()=>F(!1),onDownload:Y,onPeerReview:O,onRespondToReview:z,currentUser:i}):(0,s.jsx)(l.Card,{children:(0,s.jsxs)(l.CardContent,{className:"pt-6 space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(h.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,s.jsx)(r.Input,{placeholder:"Search by file name, course, or faculty...",value:o,onChange:e=>u(e.target.value),className:"pl-10"})]}),(0,s.jsxs)(n.Select,{value:g,onValueChange:v,children:[(0,s.jsxs)(n.SelectTrigger,{className:"w-full md:w-48",children:[(0,s.jsx)(j.Filter,{className:"h-4 w-4 mr-2"}),(0,s.jsx)(n.SelectValue,{placeholder:"Department"})]}),(0,s.jsxs)(n.SelectContent,{children:[(0,s.jsx)(n.SelectItem,{value:"all",children:"All Departments"}),E.map(e=>(0,s.jsx)(n.SelectItem,{value:e,children:e},e))]})]}),(0,s.jsxs)(n.Select,{value:w,onValueChange:S,children:[(0,s.jsxs)(n.SelectTrigger,{className:"w-full md:w-48",children:[(0,s.jsx)(j.Filter,{className:"h-4 w-4 mr-2"}),(0,s.jsx)(n.SelectValue,{placeholder:"Status"})]}),(0,s.jsxs)(n.SelectContent,{children:[(0,s.jsx)(n.SelectItem,{value:"all",children:"All Status"}),(0,s.jsx)(n.SelectItem,{value:"Approved",children:"Approved"}),(0,s.jsx)(n.SelectItem,{value:"Pending",children:"Pending"}),(0,s.jsx)(n.SelectItem,{value:"Rejected",children:"Rejected"})]})]}),(0,s.jsxs)(n.Select,{value:T,onValueChange:D,children:[(0,s.jsxs)(n.SelectTrigger,{className:"w-full md:w-48",children:[(0,s.jsx)(j.Filter,{className:"h-4 w-4 mr-2"}),(0,s.jsx)(n.SelectValue,{placeholder:"Academic Year"})]}),(0,s.jsxs)(n.SelectContent,{children:[(0,s.jsx)(n.SelectItem,{value:"all",children:"All Years"}),V.map(e=>(0,s.jsx)(n.SelectItem,{value:e,children:e},e))]})]})]}),(0,s.jsx)("div",{className:"border rounded-lg",children:(0,s.jsxs)(c.Table,{children:[(0,s.jsx)(c.TableHeader,{children:(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableHead,{children:"File Name"}),(0,s.jsx)(c.TableHead,{children:"Faculty"}),(0,s.jsx)(c.TableHead,{children:"Course"}),(0,s.jsx)(c.TableHead,{children:"Status"}),(0,s.jsx)(c.TableHead,{children:"Peer Reviews"}),(0,s.jsx)(c.TableHead,{className:"text-right",children:"Actions"})]})}),(0,s.jsx)(c.TableBody,{children:0===H.length?(0,s.jsx)(c.TableRow,{children:(0,s.jsx)(c.TableCell,{colSpan:6,className:"text-center text-gray-500 py-8",children:"No files found matching your criteria."})}):H.map(e=>(0,s.jsxs)(c.TableRow,{children:[(0,s.jsxs)(c.TableCell,{className:"flex items-center gap-2",children:[(0,s.jsx)(m.FileText,{className:"h-4 w-4 text-blue-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:e.fileName}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:e.fileType})]})]}),(0,s.jsx)(c.TableCell,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:e.facultyName}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:e.department})]})}),(0,s.jsxs)(c.TableCell,{children:[(0,s.jsx)("div",{children:e.courseCode}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:e.courseName})]}),(0,s.jsx)(c.TableCell,{children:e.status&&(0,s.jsx)(y.Badge,{className:"Approved"===e.status?"bg-green-100 text-green-800":"Rejected"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800",children:e.status})}),(0,s.jsx)(c.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(p.MessageSquare,{className:"h-4 w-4 text-gray-400"}),(0,s.jsx)("span",{className:"text-sm",children:e.peerReviews?.length||0})]})}),(0,s.jsx)(c.TableCell,{children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(t.Button,{variant:"ghost",size:"sm",onClick:()=>Y(e),children:(0,s.jsx)(x.Download,{className:"h-4 w-4"})}),(0,s.jsx)(t.Button,{variant:"ghost",size:"sm",onClick:()=>{$(e),F(!0)},children:(0,s.jsx)(f.Eye,{className:"h-4 w-4 text-blue-600"})})]})})]},e.id))})]})}),(0,s.jsx)(C.PeerReviewDialog,{open:k,onOpenChange:I,onSubmit:O,itemType:"file",itemName:A?.fileName||""}),(0,s.jsx)(b.ResponseDialog,{open:B,onOpenChange:e=>{U(e),e||P(null)},onSubmit:z,itemType:"file"})]})})}var ei=e.i(32341);function en({initialFiles:e=[],fileCategories:C=[],fileTypes:T=[]}){var D;let R,[F,A]=(0,a.useState)(e),[$,k]=(0,a.useState)(C),[I,B]=(0,a.useState)(T),{user:U,userRole:L}=(0,ei.useAuth)(),[P,Y]=(0,a.useState)(""),[O,z]=(0,a.useState)("all"),[H,E]=(0,a.useState)("all"),[V,M]=(0,a.useState)("all"),[q,J]=(0,a.useState)(!1),[K,G]=(0,a.useState)(""),[Q,W]=(0,a.useState)(""),[X,Z]=(0,a.useState)(""),[_,ee]=(0,a.useState)(""),[es,ea]=(0,a.useState)(""),[et,en]=(0,a.useState)(""),[ec,ed]=(0,a.useState)(null),[eo,em]=(0,a.useState)(new Date().getFullYear().toString()),[ex,eu]=(0,a.useState)("my-files"),[eh,ej]=(0,a.useState)(null),[ep,ef]=(0,a.useState)(!1),[eg,ev]=(0,a.useState)(!1),[ey,eN]=(0,a.useState)(!1),[ew,eb]=(0,a.useState)([]);(0,a.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/course-files"),s=await e.json();if(!e.ok)return void N.toast.error(s.error||"Failed to load files");A(s.files??[]),k(s.fileCategories??[]),B(s.fileTypes??[])}catch(e){console.error("Load files error:",e),N.toast.error("Failed to load files")}},s=async()=>{if("faculty"!==L||!U?.id)return void eb([]);try{let e=await fetch(`/api/messages?facultyId=${U.id}`),s=await e.json();if(!e.ok)return void eb([]);let a=(s.messages??[]).filter(e=>"course-file"===e.entityType);eb(a)}catch(e){console.error("Load messages error:",e),eb([])}};e(),s();{let a=()=>{e(),s()};return window.addEventListener("dashboard:data-updated",a),()=>{window.removeEventListener("dashboard:data-updated",a)}}},[U?.id,L]);let eS=async e=>{if(e.preventDefault(),!et||!X||!_||!K)return void N.toast.error("Please fill in all required fields");if(!ec)return void N.toast.error("Please choose a file to upload");try{let e=await fetch("/api/course-files",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({facultyId:U?.id,facultyName:U?.name??"",department:U?.department??"",fileName:et,documentUrl:ec,courseCode:X,courseName:_,fileType:K,uploadDate:new Date().toISOString().split("T")[0],semester:es,academicYear:eo,size:"1.5 MB",status:"Pending"})}),s=await e.json();if(!e.ok)return void N.toast.error(s.error||"Upload failed");A(s.files),J(!1),N.toast.success("File uploaded successfully"),window.dispatchEvent(new Event("dashboard:data-updated")),G(""),Z(""),ee(""),ea(""),en(""),ed(null),em(new Date().getFullYear().toString())}catch(e){console.error("File upload error:",e),N.toast.error("An error occurred during upload")}},eC=async e=>{try{let s=await fetch(`/api/course-files/${e}`,{method:"DELETE"}),a=await s.json();if(!s.ok)return void N.toast.error(a.error||"Delete failed");A(a.files),N.toast.success("File deleted successfully"),window.dispatchEvent(new Event("dashboard:data-updated"))}catch(e){console.error("Delete error:",e),N.toast.error("An error occurred while deleting")}},eT=e=>{let s=(0,el.sanitizeFileName)(e.fileName,"course-file");if(e.documentUrl){(0,el.downloadFromDataUrl)(e.documentUrl,s),N.toast.success(`Downloading ${e.fileName}`);return}let a=s.replace(/\.[^/.]+$/,""),l=`${a||"course-file"}-summary.txt`,t=`File Name: ${e.fileName}
Course: ${e.courseCode} - ${e.courseName}
Type: ${e.fileType}
Semester: ${e.semester}
Academic Year: ${e.academicYear}
Uploaded: ${e.uploadDate}
Faculty: ${e.facultyName}
Department: ${e.department}
Status: ${e.status??"Unknown"}`;(0,el.downloadTextFile)(t,l),N.toast.success(`Downloaded summary for ${e.fileName}`)},eD=async e=>{if(eh)try{let s=await fetch(`/api/course-files/${eh.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({facultyResponse:e})}),a=await s.json();if(!s.ok)return void N.toast.error(a.error||"Response update failed");A(a.files);let l=a.files.filter(e=>e.id===eh.id).reduce((e,s)=>e??s,void 0);l&&ej(l),window.dispatchEvent(new Event("dashboard:data-updated"))}catch(e){console.error("Response error:",e),N.toast.error("An error occurred while saving response")}},eR=async e=>{if(!eh||!U?.id)return;let s=`course-file:${eh.id}`,a=eI[s]??[],l=a.find(e=>e.auditorId)?.auditorId;await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({facultyId:U.id,auditorId:l,entityType:"course-file",entityId:eh.id,threadId:s,senderRole:"faculty",senderName:U.name,message:e})}),window.dispatchEvent(new Event("dashboard:data-updated"))},eF=(0,a.useMemo)(()=>"faculty"===L&&U?.id?F.filter(e=>e.facultyId===U.id):F,[F,U?.id,L]),eA=eF.filter(e=>{let s=e.fileName.toLowerCase().includes(P.toLowerCase())||e.courseCode.toLowerCase().includes(P.toLowerCase())||e.courseName.toLowerCase().includes(P.toLowerCase()),a="all"===O||e.fileType===O,l="all"===H||e.status===H,t="all"===V||e.academicYear===V;return s&&a&&l&&t}),e$=Array.from(new Set(eF.map(e=>e.status).filter(Boolean))),ek=Array.from(new Set(eF.map(e=>e.academicYear))),eI=(0,a.useMemo)(()=>ew.reduce((e,s)=>{let a=s.threadId??`${s.entityType}:${s.entityId}`;return e[a]||(e[a]=[]),e[a].push({...s,threadId:a}),e},{}),[ew]);return(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"Course File Management"}),(0,s.jsx)(l.CardDescription,{children:"Upload and manage course materials, syllabi, lesson plans, and assignments"})]}),(0,s.jsx)(l.CardContent,{className:"space-y-4",children:(0,s.jsxs)(S.Tabs,{defaultValue:"my-files",className:"w-full",children:[(0,s.jsxs)(S.TabsList,{className:"grid w-full grid-cols-2",children:[(0,s.jsx)(S.TabsTrigger,{value:"my-files",children:"My Files"}),(0,s.jsxs)(S.TabsTrigger,{value:"all-files",children:[(0,s.jsx)(v.Users,{className:"h-4 w-4 mr-2"}),"All Faculty Files"]})]}),(0,s.jsxs)(S.TabsContent,{value:"my-files",className:"space-y-4 mt-4",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(h.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,s.jsx)(r.Input,{placeholder:"Search files...",value:P,onChange:e=>Y(e.target.value),className:"pl-10"})]}),(0,s.jsxs)(n.Select,{value:O,onValueChange:z,children:[(0,s.jsxs)(n.SelectTrigger,{className:"w-full md:w-48",children:[(0,s.jsx)(j.Filter,{className:"h-4 w-4 mr-2"}),(0,s.jsx)(n.SelectValue,{placeholder:"Filter by Type"})]}),(0,s.jsxs)(n.SelectContent,{children:[(0,s.jsx)(n.SelectItem,{value:"all",children:"All Types"}),I.map(e=>(0,s.jsx)(n.SelectItem,{value:e,children:e},e))]})]}),(0,s.jsxs)(n.Select,{value:H,onValueChange:E,children:[(0,s.jsxs)(n.SelectTrigger,{className:"w-full md:w-48",children:[(0,s.jsx)(j.Filter,{className:"h-4 w-4 mr-2"}),(0,s.jsx)(n.SelectValue,{placeholder:"Filter by Status"})]}),(0,s.jsxs)(n.SelectContent,{children:[(0,s.jsx)(n.SelectItem,{value:"all",children:"All Statuses"}),e$.map(e=>(0,s.jsx)(n.SelectItem,{value:e||"unknown",children:e||"Unknown"},e||"unknown"))]})]}),(0,s.jsxs)(n.Select,{value:V,onValueChange:M,children:[(0,s.jsxs)(n.SelectTrigger,{className:"w-full md:w-48",children:[(0,s.jsx)(j.Filter,{className:"h-4 w-4 mr-2"}),(0,s.jsx)(n.SelectValue,{placeholder:"Filter by Year"})]}),(0,s.jsxs)(n.SelectContent,{children:[(0,s.jsx)(n.SelectItem,{value:"all",children:"All Years"}),ek.map(e=>(0,s.jsx)(n.SelectItem,{value:e,children:e},e))]})]}),(0,s.jsxs)(d.Dialog,{open:q,onOpenChange:J,children:[(0,s.jsx)(d.DialogTrigger,{asChild:!0,children:(0,s.jsxs)(t.Button,{className:"w-full md:w-auto",children:[(0,s.jsx)(o.Upload,{className:"h-4 w-4 mr-2"}),"Upload File"]})}),(0,s.jsxs)(d.DialogContent,{className:"max-w-md",children:[(0,s.jsxs)(d.DialogHeader,{children:[(0,s.jsx)(d.DialogTitle,{children:"Upload Course File"}),(0,s.jsx)(d.DialogDescription,{children:"Add a new course file to your repository"})]}),(0,s.jsxs)("form",{onSubmit:eS,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{htmlFor:"file",children:"File"}),(0,s.jsx)(r.Input,{id:"file",type:"file",required:!0,accept:".pdf,.doc,.docx,.ppt,.pptx",onChange:e=>{let s=e.target.files?.[0];if(!s){en(""),ed(null);return}en(s.name);let a=new FileReader;a.onloadend=()=>{ed("string"==typeof a.result?a.result:null)},a.readAsDataURL(s)}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{htmlFor:"category",children:"File Category *"}),(0,s.jsxs)(n.Select,{value:Q,onValueChange:e=>W(e),required:!0,children:[(0,s.jsx)(n.SelectTrigger,{id:"category",children:(0,s.jsx)(n.SelectValue,{placeholder:"Select file category"})}),(0,s.jsx)(n.SelectContent,{children:$.map(e=>(0,s.jsx)(n.SelectItem,{value:e,children:e},e))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{htmlFor:"courseCode",children:"Course Code"}),(0,s.jsx)(r.Input,{id:"courseCode",value:X,onChange:e=>Z(e.target.value),placeholder:"e.g., CS101",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{htmlFor:"courseName",children:"Course Name"}),(0,s.jsx)(r.Input,{id:"courseName",value:_,onChange:e=>ee(e.target.value),placeholder:"e.g., Introduction to Computer Science",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{htmlFor:"fileType",children:"File Type"}),(0,s.jsxs)(n.Select,{value:K,onValueChange:e=>G(e),children:[(0,s.jsx)(n.SelectTrigger,{id:"fileType",children:(0,s.jsx)(n.SelectValue,{placeholder:"Select file type"})}),(0,s.jsx)(n.SelectContent,{children:I.map(e=>(0,s.jsx)(n.SelectItem,{value:e,children:e},e))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{htmlFor:"semester",children:"Semester"}),(0,s.jsxs)(n.Select,{value:es,onValueChange:e=>ea(e),children:[(0,s.jsx)(n.SelectTrigger,{id:"semester",children:(0,s.jsx)(n.SelectValue,{placeholder:"Select semester"})}),(0,s.jsxs)(n.SelectContent,{children:[(0,s.jsx)(n.SelectItem,{value:"Fall",children:"Fall"}),(0,s.jsx)(n.SelectItem,{value:"Spring",children:"Spring"}),(0,s.jsx)(n.SelectItem,{value:"Summer",children:"Summer"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Label,{htmlFor:"academicYear",children:"Academic Year"}),(0,s.jsx)(r.Input,{id:"academicYear",value:eo,onChange:e=>em(e.target.value),placeholder:"2024-2025",required:!0})]})]}),(0,s.jsx)(t.Button,{type:"submit",className:"w-full",children:"Upload File"})]})]})]})]}),(0,s.jsx)("div",{className:"border rounded-lg",children:(0,s.jsxs)(c.Table,{children:[(0,s.jsx)(c.TableHeader,{children:(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableHead,{children:"File Name"}),(0,s.jsx)(c.TableHead,{children:"Course"}),(0,s.jsx)(c.TableHead,{children:"Type"}),(0,s.jsx)(c.TableHead,{children:"Semester"}),(0,s.jsx)(c.TableHead,{children:"Upload Date"}),(0,s.jsx)(c.TableHead,{children:"Size"}),(0,s.jsx)(c.TableHead,{className:"text-right",children:"Actions"})]})}),(0,s.jsx)(c.TableBody,{children:0===eA.length?(0,s.jsx)(c.TableRow,{children:(0,s.jsx)(c.TableCell,{colSpan:7,className:"text-center text-gray-500 py-8",children:"No files found. Upload your first course file to get started."})}):eA.map(e=>(0,s.jsxs)(c.TableRow,{children:[(0,s.jsxs)(c.TableCell,{className:"flex items-center gap-2",children:[(0,s.jsx)(m.FileText,{className:"h-4 w-4 text-blue-600"}),(0,s.jsx)("span",{children:e.fileName}),eI[`course-file:${e.id}`]&&(0,s.jsx)("span",{className:"h-2 w-2 rounded-full bg-red-500"})]}),(0,s.jsx)(c.TableCell,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:e.courseCode}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:e.courseName})]})}),(0,s.jsx)(c.TableCell,{children:(0,s.jsx)(y.Badge,{variant:"secondary",children:e.fileType})}),(0,s.jsxs)(c.TableCell,{children:[e.semester," ",e.academicYear]}),(0,s.jsx)(c.TableCell,{children:e.uploadDate}),(0,s.jsx)(c.TableCell,{children:e.size}),(0,s.jsx)(c.TableCell,{children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(t.Button,{variant:"ghost",size:"sm",onClick:()=>eT(e),children:(0,s.jsx)(x.Download,{className:"h-4 w-4"})}),(0,s.jsx)(t.Button,{variant:"ghost",size:"sm",onClick:()=>eC(e.id),children:(0,s.jsx)(u.Trash2,{className:"h-4 w-4 text-red-600"})}),(0,s.jsx)(t.Button,{variant:"ghost",size:"sm",onClick:()=>{ej(e),ef(!0)},children:(0,s.jsx)(f.Eye,{className:"h-4 w-4 text-blue-600"})})]})})]},e.id))})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4",children:[(0,s.jsx)(l.Card,{children:(0,s.jsxs)(l.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"text-2xl",children:eA.length}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Total Files"})]})}),(0,s.jsx)(l.Card,{children:(0,s.jsxs)(l.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"text-2xl",children:T.length}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"File Types"})]})}),(0,s.jsx)(l.Card,{children:(0,s.jsxs)(l.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"text-2xl",children:ek.length}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Years"})]})})]}),(0,s.jsx)(d.Dialog,{open:ep,onOpenChange:ef,children:(0,s.jsxs)(d.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(d.DialogHeader,{children:[(0,s.jsx)(d.DialogTitle,{children:"File Details"}),(0,s.jsx)(d.DialogDescription,{children:eh&&(0,s.jsxs)("span",{className:"flex items-center gap-2 mt-2",children:[(0,s.jsx)(m.FileText,{className:"h-4 w-4"}),eh.fileName]})})]}),eh&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Course Code"}),(0,s.jsx)("p",{children:eh.courseCode})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Course Name"}),(0,s.jsx)("p",{children:eh.courseName})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"File Type"}),(0,s.jsx)("p",{children:eh.fileType})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Semester"}),(0,s.jsxs)("p",{children:[eh.semester," ",eh.academicYear]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Upload Date"}),(0,s.jsx)("p",{children:eh.uploadDate})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"File Size"}),(0,s.jsx)("p",{children:eh.size})]})]}),eh.status&&(0,s.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("h4",{className:"flex items-center gap-2",children:[(0,s.jsx)(p.MessageSquare,{className:"h-5 w-5 text-gray-600"}),"Admin Review"]}),(0,s.jsx)(y.Badge,{className:"Approved"===eh.status?"bg-green-100 text-green-800":"Rejected"===eh.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800",children:eh.status})]}),eh.adminRemarks?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(w.Alert,{className:"Approved"===eh.status?"border-green-200 bg-green-50":"Rejected"===eh.status?"border-red-200 bg-red-50":"border-yellow-200 bg-yellow-50",children:(0,s.jsxs)(w.AlertDescription,{children:[(0,s.jsx)("p",{className:"text-sm mb-3",children:eh.adminRemarks}),eh.reviewedBy&&(0,s.jsxs)("div",{className:"text-xs text-gray-600 pt-2 border-t border-gray-200",children:[(0,s.jsxs)("p",{children:["Reviewed by: ",eh.reviewedBy]}),eh.reviewedDate&&(0,s.jsxs)("p",{children:["Date: ",eh.reviewedDate]})]})]})}),eh.facultyResponse?(0,s.jsx)(w.Alert,{className:"border-blue-200 bg-blue-50",children:(0,s.jsxs)(w.AlertDescription,{children:[(0,s.jsx)("p",{className:"text-xs text-blue-800 mb-2",children:"Your Response:"}),(0,s.jsx)("p",{className:"text-sm mb-3",children:eh.facultyResponse}),eh.responseDate&&(0,s.jsx)("div",{className:"text-xs text-gray-600 pt-2 border-t border-gray-200",children:(0,s.jsxs)("p",{children:["Response Date:"," ",eh.responseDate]})})]})}):(0,s.jsxs)(t.Button,{variant:"outline",size:"sm",onClick:()=>ev(!0),className:"w-full",children:[(0,s.jsx)(g.Reply,{className:"h-4 w-4 mr-2"}),"Respond to Admin Review"]})]}):(0,s.jsx)(w.Alert,{children:(0,s.jsx)(w.AlertDescription,{className:"text-sm text-gray-500",children:"This file is pending admin review. You will be notified once the review is complete."})})]}),(D=eh.id,0===(R=[...eI[`course-file:${D}`]??[]].sort((e,s)=>new Date(e.createdAt??0).getTime()-new Date(s.createdAt??0).getTime())).length?null:(0,s.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("h4",{className:"flex items-center gap-2",children:[(0,s.jsx)(p.MessageSquare,{className:"h-5 w-5 text-gray-600"}),"Auditor Messages"]}),(0,s.jsx)(y.Badge,{variant:"outline",children:R.length})]}),(0,s.jsx)("div",{className:"space-y-3 max-h-[40vh] overflow-y-auto pr-1",children:R.map(e=>(0,s.jsxs)("div",{className:"rounded-md border bg-white p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,s.jsx)("span",{children:e.senderName||e.senderRole||"Message"}),e.createdAt&&(0,s.jsx)("span",{children:new Date(e.createdAt).toLocaleString()})]}),(0,s.jsx)("p",{className:"text-sm text-gray-700 mt-2",children:e.message})]},e.id))}),(0,s.jsxs)(t.Button,{variant:"outline",size:"sm",onClick:()=>eN(!0),children:[(0,s.jsx)(g.Reply,{className:"h-4 w-4 mr-2"}),"Reply to Auditor"]})]})),(0,s.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,s.jsxs)(t.Button,{onClick:()=>eT(eh),className:"flex-1",children:[(0,s.jsx)(x.Download,{className:"h-4 w-4 mr-2"}),"Download File"]}),(0,s.jsx)(t.Button,{variant:"outline",onClick:()=>ef(!1),children:"Close"})]})]})]})}),(0,s.jsx)(b.ResponseDialog,{open:eg,onOpenChange:ev,onSubmit:eD,itemType:"file"}),(0,s.jsx)(b.ResponseDialog,{open:ey,onOpenChange:eN,onSubmit:eR,itemType:"file"})]}),(0,s.jsx)(S.TabsContent,{value:"all-files",className:"space-y-4 mt-4",children:(0,s.jsx)(er,{files:eF,currentUser:U?.name??"",onFilesChange:A})})]})})]})}e.s(["CourseFileManager",()=>en],3166)}]);