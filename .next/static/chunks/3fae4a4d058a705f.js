(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,68349,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(15288),r=e.i(19455),l=e.i(87486),i=e.i(71689),n=e.i(40160),d=e.i(46696),c=e.i(10204);function o({checklist:e,checkedItems:t,onChecklistChange:l}){return(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)(a.Card,{className:"sticky top-4 h-fit flex flex-col rounded-lg border border-gray-200 shadow-md",children:[(0,s.jsx)(a.CardHeader,{className:"flex-shrink-0 border-b",children:(0,s.jsx)(a.CardTitle,{className:"text-base",children:"Audit Checklist"})}),(0,s.jsx)(a.CardContent,{className:"max-h-[calc(100vh-200px)] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:(0,s.jsx)("div",{className:"space-y-4 pr-2",children:e.map(e=>{let a=t[e.id]||"pending";return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(c.Label,{className:"text-sm leading-tight",children:e.label}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(r.Button,{size:"sm",variant:"yes"===a?"default":"outline",onClick:()=>l(e.id,"yes"),className:"flex-1 text-xs",children:"Yes"}),(0,s.jsx)(r.Button,{size:"sm",variant:"no"===a?"destructive":"outline",onClick:()=>l(e.id,"no"),className:"flex-1 text-xs",children:"No"}),(0,s.jsx)(r.Button,{size:"sm",variant:"pending"===a?"default":"outline",onClick:()=>l(e.id,"pending"),className:"flex-1 text-xs",children:"Pending"})]})]},e.id)})})}),(0,s.jsx)("div",{className:"flex-shrink-0 pt-4 border-t px-6 pb-4 bg-white",children:(0,s.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"Yes:"}),(0,s.jsx)("span",{className:"font-medium",children:Object.values(t).filter(e=>"yes"===e).length})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"No:"}),(0,s.jsx)("span",{className:"font-medium",children:Object.values(t).filter(e=>"no"===e).length})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"Pending:"}),(0,s.jsx)("span",{className:"font-medium",children:e.length-Object.keys(t).length+Object.values(t).filter(e=>"pending"===e).length})]})]})})]})})}var m=e.i(78583),x=e.i(87316);function h({type:e,item:t,onDownload:l}){return(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{children:(0,s.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:["file"===e?(0,s.jsx)(m.FileText,{className:"h-5 w-5"}):(0,s.jsx)(x.Calendar,{className:"h-5 w-5"}),"Document Viewer"]})}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)("div",{className:"aspect-[16/10] bg-gray-100 rounded-lg flex items-center justify-center border-2 border-dashed border-gray-300",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(m.FileText,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"file"===e?`Document: ${t.fileName}`:`Report: ${t.eventName}`}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Live document preview would appear here"}),(0,s.jsxs)(r.Button,{variant:"outline",size:"sm",className:"mt-4",onClick:l,children:[(0,s.jsx)(n.Download,{className:"h-4 w-4 mr-2"}),"Download Document"]})]})})})]})}function u({type:e,item:t}){return(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{children:(0,s.jsx)(a.CardTitle,{children:"Document Details"})}),(0,s.jsx)(a.CardContent,{children:"file"===e?(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"File Type"}),(0,s.jsx)("p",{children:t.fileType})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Upload Date"}),(0,s.jsx)("p",{children:t.uploadDate})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Course Name"}),(0,s.jsx)("p",{children:t.courseName})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Semester"}),(0,s.jsx)("p",{children:t.semester})]})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Event Type"}),(0,s.jsx)("p",{children:t.eventType})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Event Date"}),(0,s.jsx)("p",{children:t.eventDate})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Location"}),(0,s.jsx)("p",{children:t.location})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Participants"}),(0,s.jsx)("p",{children:t.participants})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Description"}),(0,s.jsx)("p",{className:"text-sm",children:t.description})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Objectives"}),(0,s.jsx)("p",{className:"text-sm",children:t.objectives})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Outcomes & Impact"}),(0,s.jsx)("p",{className:"text-sm",children:t.outcomes})]})]})})]})}var p=e.i(24687),j=e.i(75254);let g=(0,j.default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var v=e.i(73884);function f({type:e,auditorRemarks:t,onRemarksChange:l,reviewDecision:i,onDecisionChange:n,onSubmit:c,checklist:o,checkedItems:m}){return(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{children:(0,s.jsx)(a.CardTitle,{children:"Auditor Remarks"})}),(0,s.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,s.jsx)(p.Textarea,{placeholder:"Provide detailed feedback and remarks...",value:t,onChange:e=>l(e.target.value),rows:6}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)(r.Button,{variant:"approve"===i?"default":"outline",onClick:()=>n("approve"),className:"flex-1",children:[(0,s.jsx)(g,{className:"h-4 w-4 mr-2"}),"Approve"]}),(0,s.jsxs)(r.Button,{variant:"reject"===i?"destructive":"outline",onClick:()=>n("reject"),className:"flex-1",children:[(0,s.jsx)(v.XCircle,{className:"h-4 w-4 mr-2"}),"Reject"]})]}),(0,s.jsx)(r.Button,{onClick:()=>{i?o.every(e=>m[e.id])?t.trim()?c():d.toast.error("Please provide auditor remarks"):d.toast.error("Please complete all checklist items"):d.toast.error("Please select approve or reject")},className:"w-full",size:"lg",children:"Submit Review"})]})]})}var N=e.i(32341),y=e.i(43682);let b=[{id:"co_po_mapping",label:"CO–PO Mapping (CO–PO Mapping Level)"},{id:"co_pso_mapping",label:"CO–PO Mapping (CO–PSO Mapping Level)"},{id:"justification",label:"Justification of Mapping"},{id:"course_coverage",label:"Course File Coverage"},{id:"test_qp",label:"Test (QP)"},{id:"test_co_level",label:"Test (CO Level)"},{id:"test_sample_answer",label:"Test (Sample Answer Sheets)"},{id:"test_qp_second",label:"Test (QP) – Second"},{id:"test_co_level_second",label:"Test (CO Level) – Second"},{id:"test_sample_answer_second",label:"Test (Sample Answer Sheets) – Second"},{id:"assignment_qp",label:"Assignment (QP)"},{id:"assignment_co_level",label:"Assignment (CO Level)"},{id:"assignment_sample",label:"Assignment (Sample)"},{id:"assignment_qp_second",label:"Assignment (QP) – Second"},{id:"assignment_co_level_second",label:"Assignment (CO Level) – Second"},{id:"assignment_sample_second",label:"Assignment (Sample) – Second"},{id:"sample_tutorial",label:"Sample Tutorial"},{id:"attendance",label:"Attendance (%)"},{id:"internal_marks",label:"Internal Marks Display"},{id:"course_exit_survey",label:"Course Exit Survey"},{id:"attainment_calculation",label:"Attainment Calculation"},{id:"remarks",label:"Remarks"},{id:"score",label:"Score (Faculty/Auditor)"}],w=[{id:"details",label:"Event details are complete and accurate"}];function C({type:e,item:c,facultyName:m,facultyId:x,onBack:p,onReviewCompleted:j}){let[g,v]=(0,t.useState)({}),[C,R]=(0,t.useState)(""),[T,k]=(0,t.useState)(null),{user:S}=(0,N.useAuth)(),A="file"===e?b:w,D=async()=>{if(!T)return void d.toast.error("Please select approve or reject");let s="approve"===T?"Approved":"Rejected",t=new Date().toISOString().split("T")[0],a=S?.name??"Auditor";try{let r=await fetch("file"===e?`/api/course-files/${c.id}`:`/api/event-reports/${c.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s,adminRemarks:C,reviewedBy:a,reviewedDate:t})}),l=await r.json();if(!r.ok)return void d.toast.error(l.error||"Review update failed");let i=("file"===e?l.files:l.reports).filter(e=>e.id===c.id).reduce((e,s)=>e??s,void 0);if(i&&j?.(i),await fetch("/api/audits",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auditorId:S?.id,entityType:"file"===e?"course-file":"event-report",entityId:c.id,status:"approve"===T?"completed":"rejected",remarks:C})}),await fetch("/api/remarks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({authorId:S?.id,entityType:"file"===e?"course-file":"event-report",entityId:c.id,status:"published",text:C})}),x){let t=`${"file"===e?"course-file":"event-report"}:${c.id}`;await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({facultyId:x,auditorId:S?.id,entityType:"file"===e?"course-file":"event-report",entityId:c.id,threadId:t,senderRole:"auditor",senderName:S?.name,message:C||`${"file"===e?"Course file":"Event report"} ${s.toLowerCase()}.`,status:s.toLowerCase()})})}d.toast.success(`${"file"===e?"Course file":"Event report"} ${T}d successfully`),window.dispatchEvent(new Event("dashboard:data-updated")),p()}catch(e){console.error("Review submit error:",e),d.toast.error("Failed to submit review")}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(r.Button,{variant:"outline",onClick:p,children:[(0,s.jsx)(i.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to Faculty List"]}),(0,s.jsxs)(r.Button,{variant:"outline",onClick:()=>{let s="Checklist Item,Status\n";A.forEach(e=>{let t=g[e.id]||"pending";s+=`"${e.label}",${t}
`});let t=new Blob([s+=`
Remarks,"${C}"
Decision,${T||"pending"}
`],{type:"text/csv"}),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a;let l="file"===e?c.fileName:c.eventName?.replace(/ /g,"_")||"report";r.download=`audit-${m.replace(/ /g,"_")}-${l}.csv`,r.click(),window.URL.revokeObjectURL(a),d.toast.success("Audit sheet downloaded successfully")},children:[(0,s.jsx)(n.Download,{className:"h-4 w-4 mr-2"}),"Download Audit Sheet"]})]}),(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:m}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"file"===e?"Course File Review":"Event Report Review"})]}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsx)(l.Badge,{className:"approve"===T?"bg-green-100 text-green-800":"",variant:"approve"===T?"default":"outline",children:"approve"===T?"Approved":"Not Approved"})})]})})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,s.jsx)(o,{checklist:A,checkedItems:g,onChecklistChange:(e,s)=>{v({...g,[e]:s})}}),(0,s.jsxs)("div",{className:"lg:col-span-3 space-y-6",children:[(0,s.jsx)(h,{type:e,item:c,onDownload:()=>{if("file"===e){let e=(0,y.sanitizeFileName)(c.fileName,"course-file");if(c.documentUrl){(0,y.downloadFromDataUrl)(c.documentUrl,e),d.toast.success(`Downloading ${c.fileName}`);return}let s=e.replace(/\.[^/.]+$/,""),t=`${s||"course-file"}-summary.txt`,a=`File Name: ${c.fileName}
Document data is not available in storage.`;(0,y.downloadTextFile)(a,t),d.toast.success(`Downloaded summary for ${c.fileName}`);return}let s=(0,y.sanitizeFileName)(c.eventName,"event-report"),t=`${s||"event-report"}.json`;(0,y.downloadJsonFile)(c,t),d.toast.success(`Downloading ${c.eventName}`)}}),(0,s.jsx)(u,{type:e,item:c}),(0,s.jsx)(f,{type:e,item:c,auditorRemarks:C,onRemarksChange:R,reviewDecision:T,onDecisionChange:k,onSubmit:D,checklist:A,checkedItems:g})]})]})]})}function R({onBack:e}){return(0,s.jsxs)(r.Button,{variant:"outline",onClick:e,children:[(0,s.jsx)(i.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to Faculty List"]})}function T({faculty:e}){return(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"h-16 w-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-2xl font-semibold",children:e.name.split(" ").map(e=>e[0]).join("")}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:e.name}),(0,s.jsx)("p",{className:"text-gray-600",children:e.department}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mt-2",children:[(0,s.jsxs)(l.Badge,{variant:"outline",children:[e.totalFiles," Course Files"]}),(0,s.jsxs)(l.Badge,{variant:"outline",children:[e.totalReports," Event Reports"]})]})]})]})})}var k=e.i(77572),S=e.i(98919);function A({report:e,onReview:t,getStatusColor:i}){return(0,s.jsx)(a.Card,{className:"hover:shadow-lg transition-shadow",children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 flex-1",children:[(0,s.jsx)("div",{className:"h-10 w-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,s.jsx)(x.Calendar,{className:"h-5 w-5 text-green-600"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium line-clamp-1",children:e.eventName}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.location})]})]}),(0,s.jsx)(l.Badge,{className:i(e.status),children:e.status})]}),(0,s.jsx)("div",{className:"flex items-center justify-between text-sm",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(l.Badge,{variant:"outline",children:e.eventType}),(0,s.jsxs)("span",{className:"text-gray-500",children:[e.participants," participants"]})]})}),e.auditorRemarks&&(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-green-800 mb-1",children:"Auditor Remarks:"}),(0,s.jsx)("p",{className:"text-sm text-green-700",children:e.auditorRemarks})]}),(0,s.jsxs)(r.Button,{variant:"Submitted"===e.status?"default":"outline",size:"sm",onClick:()=>t(e),className:"w-full",children:[(0,s.jsx)(S.Shield,{className:"h-4 w-4 mr-2"}),"Submitted"===e.status?"Review & Audit":"View Review"]})]})})})}var D=e.i(86536),F=e.i(95468),B=e.i(3116),O=e.i(63209),E=e.i(64659),I=e.i(63059);function _({courseFiles:e,onReviewFile:i,getStatusColor:n}){let d,[c,o]=(0,t.useState)(new Set),h=(d={},e.forEach(e=>{let s=e.courseCode||"Unknown";d[s]||(d[s]=[]),d[s].push(e)}),d),u=Object.keys(h).sort();return 0===u.length?(0,s.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,s.jsx)(m.FileText,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,s.jsx)("p",{children:"No course files available yet."})]}):(0,s.jsx)("div",{className:"space-y-6",children:u.map(e=>{let t=h[e],d=t.filter(e=>"Approved"===e.status).length;t.filter(e=>"Pending"===e.status||"Submitted"===e.status).length;let u=t.filter(e=>"Rejected"===e.status).length,p=t.filter(e=>"Submitted"===e.status||"Pending"===e.status).length,j=t[0]?.courseName||e,g=c.has(e);return(0,s.jsxs)(a.Card,{className:"border-l-4 border-l-purple-500 hover:shadow-lg transition-shadow",children:[(0,s.jsx)(a.CardHeader,{className:"pb-3 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>{o(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[g?(0,s.jsx)(E.ChevronDown,{className:"h-5 w-5 text-gray-600"}):(0,s.jsx)(I.ChevronRight,{className:"h-5 w-5 text-gray-600"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(a.CardTitle,{className:"text-xl font-bold text-gray-900",children:e}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:j})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[(0,s.jsxs)(l.Badge,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[t.length," ",1===t.length?"File":"Files"]}),p>0&&(0,s.jsxs)(l.Badge,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:[(0,s.jsx)(O.AlertCircle,{className:"h-3 w-3 mr-1"}),p," To Review"]}),d>0&&(0,s.jsxs)(l.Badge,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[(0,s.jsx)(F.CheckCircle2,{className:"h-3 w-3 mr-1"}),d]}),u>0&&(0,s.jsxs)(l.Badge,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:[(0,s.jsx)(v.XCircle,{className:"h-3 w-3 mr-1"}),u]})]})]})}),g&&(0,s.jsx)(a.CardContent,{children:(0,s.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(e=>{switch(e){case"Approved":return(0,s.jsx)(F.CheckCircle2,{className:"h-4 w-4 text-green-600"});case"Rejected":return(0,s.jsx)(v.XCircle,{className:"h-4 w-4 text-red-600"});case"Pending":case"Submitted":return(0,s.jsx)(B.Clock,{className:"h-4 w-4 text-yellow-600"});default:return(0,s.jsx)(m.FileText,{className:"h-4 w-4 text-gray-600"})}})(e.status),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium text-gray-900 truncate",children:e.fileName}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-500",children:[(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(m.FileText,{className:"h-3 w-3"}),e.fileType]}),(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(x.Calendar,{className:"h-3 w-3"}),new Date(e.uploadDate).toLocaleDateString()]}),e.semester&&(0,s.jsx)("span",{children:e.semester})]}),e.auditorRemarks&&(0,s.jsxs)("p",{className:"text-xs text-gray-600 mt-1 italic",children:["Remarks: ",e.auditorRemarks]})]}),(0,s.jsx)(l.Badge,{className:n(e.status),children:e.status})]}),(0,s.jsx)("div",{className:"flex items-center gap-2 ml-3",children:(0,s.jsxs)(r.Button,{size:"sm",variant:"Submitted"===e.status||"Pending"===e.status?"default":"outline",onClick:()=>i(e),className:"h-8 px-3",children:[(0,s.jsx)(D.Eye,{className:"h-4 w-4 mr-1"}),"Submitted"===e.status||"Pending"===e.status?"Review":"View"]})})]},e.id))})})]},e)})})}function M({courseFiles:e,eventReports:t,onReviewFile:a,onReviewReport:r,getStatusColor:l}){return(0,s.jsxs)(k.Tabs,{defaultValue:"course-files",children:[(0,s.jsxs)(k.TabsList,{className:"grid w-full grid-cols-2",children:[(0,s.jsxs)(k.TabsTrigger,{value:"course-files",children:[(0,s.jsx)(m.FileText,{className:"h-4 w-4 mr-2"}),"Course Files"]}),(0,s.jsxs)(k.TabsTrigger,{value:"event-reports",children:[(0,s.jsx)(x.Calendar,{className:"h-4 w-4 mr-2"}),"Event Reports"]})]}),(0,s.jsx)(k.TabsContent,{value:"course-files",className:"space-y-4 mt-6",children:(0,s.jsx)(_,{courseFiles:e,onReviewFile:a,getStatusColor:l})}),(0,s.jsx)(k.TabsContent,{value:"event-reports",className:"space-y-4 mt-6",children:(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map(e=>(0,s.jsx)(A,{report:e,onReview:r,getStatusColor:l},e.id))})})]})}var P=e.i(72871);function L({faculty:e,onBack:i}){let{user:n}=(0,N.useAuth)(),[d,c]=(0,t.useState)(!1),[o,m]=(0,t.useState)(null),[x,h]=(0,t.useState)(null),[u,p]=(0,t.useState)(null),[j,g]=(0,t.useState)(!1),[v,f]=(0,t.useState)("file"),[y,b]=(0,t.useState)([]),[w,k]=(0,t.useState)([]),[S,A]=(0,t.useState)([]),D=Object.entries(S.reduce((e,s)=>{let t=s.threadId??`${s.entityType}:${s.entityId}`;return e[t]||(e[t]=[]),e[t].push({...s,threadId:t}),e},{})).map(([e,s])=>{let t=[...s].sort((e,s)=>{let t=new Date(e.createdAt??0).getTime();return new Date(s.createdAt??0).getTime()-t}),a=t[t.length-1];return{threadId:e,messages:t,lastMessage:a}}).sort((e,s)=>{let t=new Date(e.lastMessage?.createdAt??0).getTime();return new Date(s.lastMessage?.createdAt??0).getTime()-t}),F=y.reduce((e,s)=>(e[s.id]=s.fileName,e),{}),B=w.reduce((e,s)=>(e[s.id]=s.eventName,e),{}),O=D.reduce((e,s)=>{if(s.lastMessage?.entityType!=="course-file")return e;let t=s.lastMessage.entityId,a=F[t]??"Course File";return e[t]||(e[t]={fileId:t,fileName:a,threads:[]}),e[t].threads.push(s),e},{});Object.values(O).forEach(e=>{e.threads.sort((e,s)=>{let t=new Date(e.lastMessage?.createdAt??0).getTime();return new Date(s.lastMessage?.createdAt??0).getTime()-t})});let E=D.reduce((e,s)=>{if(s.lastMessage?.entityType!=="event-report")return e;let t=s.lastMessage.entityId,a=B[t]??"Event Report";return e[t]||(e[t]={reportId:t,reportName:a,threads:[]}),e[t].threads.push(s),e},{});Object.values(E).forEach(e=>{e.threads.sort((e,s)=>{let t=new Date(e.lastMessage?.createdAt??0).getTime();return new Date(s.lastMessage?.createdAt??0).getTime()-t})});let I=Object.values(O).sort((e,s)=>{let t=e.threads[0]?.lastMessage?.createdAt??0;return new Date(s.threads[0]?.lastMessage?.createdAt??0).getTime()-new Date(t).getTime()}),_=Object.values(E).sort((e,s)=>{let t=e.threads[0]?.lastMessage?.createdAt??0;return new Date(s.threads[0]?.lastMessage?.createdAt??0).getTime()-new Date(t).getTime()});(0,t.useEffect)(()=>{let s=async()=>{try{let[s,t,a]=await Promise.all([fetch("/api/course-files"),fetch("/api/event-reports"),fetch(`/api/messages?facultyId=${e.id}`)]),r=await s.json(),l=await t.json(),i=await a.json();if(!s.ok||!t.ok||!a.ok)return;let n=(r.files??[]).filter(s=>s.facultyId===e.id),d=(l.reports??[]).filter(s=>s.facultyId===e.id);b(n),k(d),A(i.messages??[])}catch(e){console.error("Load faculty portfolio error:",e)}};s();{let e=()=>{s()};return window.addEventListener("dashboard:data-updated",e),()=>{window.removeEventListener("dashboard:data-updated",e)}}},[e.id]);let L=D.find(e=>e.threadId===o)??null,$=async s=>{if(!n?.id||!L)return;let t=L.messages[0];await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({facultyId:e.id,auditorId:n.id,entityType:t.entityType,entityId:t.entityId,threadId:L.threadId,senderRole:"auditor",senderName:n.name,message:s})}),window.dispatchEvent(new Event("dashboard:data-updated"))},z=async e=>{await fetch(`/api/messages?threadId=${e}`,{method:"DELETE"}),window.dispatchEvent(new Event("dashboard:data-updated"))};return j&&(x||u)?(0,s.jsx)(C,{type:v,item:"file"===v?x:u,facultyName:e.name,facultyId:e.id,onBack:()=>g(!1),onReviewCompleted:e=>{"file"===v?(b(s=>s.map(s=>s.id===e.id?e:s)),h(e)):(k(s=>s.map(s=>s.id===e.id?e:s)),p(e))}}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(R,{onBack:i}),(0,s.jsx)(T,{faculty:e}),(0,s.jsx)(a.Card,{children:(0,s.jsxs)(a.CardContent,{className:"pt-6 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Auditor Messages"}),(0,s.jsx)(l.Badge,{variant:"outline",children:D.length})]}),0===I.length&&0===_.length?(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"No messages yet."}):(0,s.jsxs)("div",{className:"space-y-3",children:[I.map(e=>(0,s.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.fileName}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Course File"})]}),(0,s.jsx)(l.Badge,{variant:"outline",children:e.threads.reduce((e,s)=>e+s.messages.length,0)})]}),(0,s.jsx)("div",{className:"mt-3 space-y-3",children:e.threads.map(e=>(0,s.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Thread"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.lastMessage?.status&&(0,s.jsx)(l.Badge,{variant:"secondary",children:e.lastMessage.status}),(0,s.jsx)(r.Button,{variant:"outline",size:"sm",onClick:()=>{m(e.threadId),c(!0)},children:"Reply"}),(0,s.jsx)(r.Button,{size:"sm",onClick:()=>z(e.threadId),children:"OK"})]})]}),(0,s.jsx)("div",{className:"mt-3 space-y-2",children:e.messages.map(e=>(0,s.jsxs)("div",{className:"rounded-md bg-white p-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,s.jsx)("span",{children:e.senderName||e.senderRole||"Message"}),e.createdAt&&(0,s.jsx)("span",{children:new Date(e.createdAt).toLocaleString()})]}),(0,s.jsx)("p",{className:"text-sm text-gray-700 mt-1",children:e.message})]},e.id))})]},e.threadId))})]},e.fileId)),_.map(e=>(0,s.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.reportName}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Event Report"})]}),(0,s.jsx)(l.Badge,{variant:"outline",children:e.threads.reduce((e,s)=>e+s.messages.length,0)})]}),(0,s.jsx)("div",{className:"mt-3 space-y-3",children:e.threads.map(e=>(0,s.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Thread"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.lastMessage?.status&&(0,s.jsx)(l.Badge,{variant:"secondary",children:e.lastMessage.status}),(0,s.jsx)(r.Button,{variant:"outline",size:"sm",onClick:()=>{m(e.threadId),c(!0)},children:"Reply"}),(0,s.jsx)(r.Button,{size:"sm",onClick:()=>z(e.threadId),children:"OK"})]})]}),(0,s.jsx)("div",{className:"mt-3 space-y-2",children:e.messages.map(e=>(0,s.jsxs)("div",{className:"rounded-md bg-white p-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,s.jsx)("span",{children:e.senderName||e.senderRole||"Message"}),e.createdAt&&(0,s.jsx)("span",{children:new Date(e.createdAt).toLocaleString()})]}),(0,s.jsx)("p",{className:"text-sm text-gray-700 mt-1",children:e.message})]},e.id))})]},e.threadId))})]},e.reportId))]})]})}),(0,s.jsx)(M,{courseFiles:y,eventReports:w,onReviewFile:e=>{h(e),f("file"),g(!0)},onReviewReport:e=>{p(e),f("report"),g(!0)},getStatusColor:e=>{switch(e){case"Approved":return"bg-green-100 text-green-800";case"Pending":return"bg-yellow-100 text-yellow-800";case"Submitted":return"bg-blue-100 text-blue-800";case"Draft":default:return"bg-gray-100 text-gray-800";case"Rejected":return"bg-red-100 text-red-800"}}}),(0,s.jsx)(P.ResponseDialog,{open:d,onOpenChange:c,onSubmit:$,itemType:L?.lastMessage?.entityType==="course-file"?"file":"report"})]})}function $(){return(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"h-12 w-12 bg-orange-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)(S.Shield,{className:"h-6 w-6 text-orange-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{children:"Auditor Dashboard"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Quality Assurance & Compliance Review"})]})]})}var z=e.i(61911);function U({stats:e}){return(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Total Faculty"}),(0,s.jsx)("div",{className:"text-2xl mt-1",children:e.totalFaculty})]}),(0,s.jsx)("div",{className:"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)(z.Users,{className:"h-6 w-6 text-blue-600"})})]})})}),(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Total Course Files"}),(0,s.jsx)("div",{className:"text-2xl mt-1",children:e.totalFiles}),(0,s.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:[e.approvedFiles," approved"]})]}),(0,s.jsx)("div",{className:"h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)(m.FileText,{className:"h-6 w-6 text-green-600"})})]})})}),(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Total Event Reports"}),(0,s.jsx)("div",{className:"text-2xl mt-1",children:e.totalReports}),(0,s.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:[e.approvedReports," approved"]})]}),(0,s.jsx)("div",{className:"h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)(x.Calendar,{className:"h-6 w-6 text-purple-600"})})]})})}),(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Pending Reviews"}),(0,s.jsx)("div",{className:"text-2xl mt-1",children:e.pendingFiles+e.pendingReports}),(0,s.jsx)("p",{className:"text-xs text-orange-600 mt-1",children:"Requires attention"})]}),(0,s.jsx)("div",{className:"h-12 w-12 bg-orange-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)(O.AlertCircle,{className:"h-6 w-6 text-orange-600"})})]})})})]})}var H=e.i(29592);function q({stats:e}){let t=e.pendingFiles+e.pendingReports;return 0===t?null:(0,s.jsxs)(H.Alert,{className:"bg-orange-50 border-orange-200",children:[(0,s.jsx)(O.AlertCircle,{className:"h-4 w-4 text-orange-600"}),(0,s.jsxs)(H.AlertDescription,{children:["You have ",t," pending items awaiting review and approval."]})]})}function J({stats:e}){let t=e.approvedFiles+e.rejectedFiles,r=e.approvedReports+e.rejectedReports,l=t>0?Math.round(e.approvedFiles/t*100):0,i=r>0?Math.round(e.approvedReports/r*100):0;return(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsx)(a.CardTitle,{children:"Review Statistics"}),(0,s.jsx)(a.CardDescription,{children:"Overall submission quality metrics"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm",children:"Course Files Approved"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:[l,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${l}%`}})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600 mt-2",children:[(0,s.jsxs)("span",{children:["Approved: ",e.approvedFiles]}),(0,s.jsxs)("span",{children:["Rejected: ",e.rejectedFiles]}),(0,s.jsxs)("span",{children:["Pending: ",e.pendingFiles]}),(0,s.jsxs)("span",{children:["Total: ",e.totalFiles]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm",children:"Event Reports Approved"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:[i,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${i}%`}})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600 mt-2",children:[(0,s.jsxs)("span",{children:["Approved: ",e.approvedReports]}),(0,s.jsxs)("span",{children:["Rejected: ",e.rejectedReports]}),(0,s.jsxs)("span",{children:["Pending: ",e.pendingReports]}),(0,s.jsxs)("span",{children:["Total: ",e.totalReports]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm",children:"Overall Completion Rate"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:[e.completionRate,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${e.completionRate}%`}})})]})]})})]})}function Q({reviews:e}){return(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsx)(a.CardTitle,{children:"Recent Review Activity"}),(0,s.jsx)(a.CardDescription,{children:"Your latest review actions"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)("div",{className:"space-y-4",children:e.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start gap-3 pb-3 border-b last:border-0",children:[(0,s.jsx)("div",{className:"h-2 w-2 rounded-full bg-orange-600 mt-2"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"font-medium",children:e.action})," ",e.item]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e.faculty," • ",e.time]})]})]},t))})})]})}let V=(0,j.default)("clipboard-check",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);function K({faculty:e}){return(0,s.jsxs)("div",{className:"flex items-center gap-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Course Files"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(l.Badge,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[(0,s.jsx)(g,{className:"h-3 w-3 mr-1"}),e.approvedFiles]}),e.pendingFiles>0&&(0,s.jsxs)(l.Badge,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:[(0,s.jsx)(O.AlertCircle,{className:"h-3 w-3 mr-1"}),e.pendingFiles]})]})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Event Reports"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(l.Badge,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[(0,s.jsx)(g,{className:"h-3 w-3 mr-1"}),e.approvedReports]}),e.pendingReports>0&&(0,s.jsxs)(l.Badge,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:[(0,s.jsx)(O.AlertCircle,{className:"h-3 w-3 mr-1"}),e.pendingReports]})]})]})]})}function Y({faculty:e,onClick:t}){return(0,s.jsx)(a.Card,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>t(e),children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,s.jsx)("div",{className:"h-12 w-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white flex-shrink-0",children:e.name.split(" ").map(e=>e[0]).join("")}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium",children:e.name}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.department})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-6",children:[(0,s.jsx)(K,{faculty:e}),(0,s.jsxs)(r.Button,{variant:"outline",size:"sm",children:[(0,s.jsx)(D.Eye,{className:"h-4 w-4 mr-2"}),"Review",(0,s.jsx)(I.ChevronRight,{className:"h-4 w-4 ml-2"})]})]})]})})})}function X({facultyMembers:e,onSelectFaculty:t}){return(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(V,{className:"h-5 w-5"}),"Faculty Submission Status"]}),(0,s.jsx)(a.CardDescription,{children:"Review and audit faculty course files and event reports"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)("div",{className:"space-y-3",children:e.map(e=>(0,s.jsx)(Y,{faculty:e,onClick:t},e.id))})})]})}function G({stats:e,facultyMembers:a,recentReviews:r}){let[l,i]=(0,t.useState)(null),[n,d]=(0,t.useState)(e),[c,o]=(0,t.useState)(a),[m,x]=(0,t.useState)(r);return((0,t.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/dashboard/auditor"),s=await e.json();if(!e.ok)return;s?.stats&&d(s.stats),s?.facultyMembers&&o(s.facultyMembers),s?.recentReviews&&x(s.recentReviews)}catch(e){console.error("Auditor dashboard refresh error:",e)}};e();{let s=()=>{e()};return window.addEventListener("dashboard:data-updated",s),()=>{window.removeEventListener("dashboard:data-updated",s)}}},[]),l)?(0,s.jsx)(L,{faculty:l,onBack:()=>i(null)}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)($,{}),(0,s.jsx)(U,{stats:n}),(0,s.jsx)(q,{stats:n}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsx)(J,{stats:n}),(0,s.jsx)(Q,{reviews:m})]}),(0,s.jsx)(X,{facultyMembers:c,onSelectFaculty:i})]})}e.s(["AuditorDashboard",()=>G],68349)}]);